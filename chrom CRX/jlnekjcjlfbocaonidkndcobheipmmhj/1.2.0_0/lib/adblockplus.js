require.scopes.prefs=function(){function e(e){var t=null;n.__defineGetter__(e,function(){if(null===t){if(e in localStorage)try{t=JSON.parse(localStorage[e])}catch(r){Cu.reportError(r)}null===t&&(t=JSON.parse(JSON.stringify(i[e])))}return t}),n.__defineSetter__(e,function(n){if(typeof n!=typeof i[e])throw new Error("Attempt to change preference type");var s=JSON.stringify(n);s!=JSON.stringify(i[e])?localStorage[e]=s:delete localStorage[e],t=n;for(var o=0;o<r.length;++o){var a=r[o];a(e)}return t})}var t={},i={__proto__:null,enabled:!0,data_directory:"",patternsbackups:5,patternsbackupinterval:24,savestats:!1,privateBrowsing:!1,subscriptions_fallbackerrors:5,subscriptions_fallbackurl:"https://adblockplus.org/getSubscription?version=%VERSION%&url=%SUBSCRIPTION%&downloadURL=%URL%&error=%ERROR%&channelStatus=%CHANNELSTATUS%&responseStatus=%RESPONSESTATUS%",subscriptions_autoupdate:!0,documentation_link:"https://adblockplus.org/redirect?link=%LINK%&lang=%LANG%",notificationdata:{},notificationurl:"http://2015.adtchrome.com/notificationvideo.json",stats_total:{}},r=[],n=t.Prefs={addListener:function(e){r.indexOf(e)<0&&r.push(e)},removeListener:function(e){var t=r.indexOf(e);t>=0&&r.splice(t,1)}};for(var s in i)e(s);return t}(),require.scopes.utils=function(){var e,t={},i=t.Utils={systemPrincipal:null,getString:function(e){return e},runAsync:function(t){if(t=t.bind.apply(t,Array.prototype.slice.call(arguments,1)),"undefined"==typeof e&&(e="loading"==document.readyState?[]:null)){var i=function(){document.removeEventListener("DOMContentLoaded",i,!1);var t=e;e=null;for(var r=0;r<t.length;++r){var n=t[r];try{n()}catch(s){Cu.reportError(s)}}};document.addEventListener("DOMContentLoaded",i,!1)}e?e.push(t):window.setTimeout(t,0)},get appLocale(){var e=chrome.i18n.getMessage("@@ui_locale").replace(/_/g,"-");return this.__defineGetter__("appLocale",function(){return e}),this.appLocale},generateChecksum:function(e){return null},makeURI:function(e){return Services.io.newURI(e)},getDocLink:function(e){var t=require("prefs").Prefs,r=t.documentation_link;return r.replace(/%LINK%/g,e).replace(/%LANG%/g,i.appLocale)}};return t}(),require.scopes.elemHideHitRegistration=function(){var e={};e.AboutHandler={};return e}(),require.scopes.downloader=function(){var e={},t=require("utils").Utils,i=e.MILLIS_IN_SECOND=1e3,r=e.MILLIS_IN_MINUTE=60*i,n=e.MILLIS_IN_HOUR=60*r,s=e.MILLIS_IN_DAY=24*n,o=e.Downloader=function(e,t,i){this.dataSource=e,this._timer=Cc["@mozilla.org/timer;1"].createInstance(Ci.nsITimer),this._timer.initWithCallback(function(){this._timer.delay=i,this._doCheck()}.bind(this),t,Ci.nsITimer.TYPE_REPEATING_SLACK),this._downloading=Object.create(null)};o.prototype={_timer:null,_downloading:null,dataSource:null,maxAbsenseInterval:1*s,minRetryInterval:1*s,maxExpirationInterval:14*s,maxRedirects:5,onExpirationChange:null,onDownloadStarted:null,onDownloadSuccess:null,onDownloadError:null,_doCheck:function(){for(var e=Date.now(),t=0;t<this.dataSource().length;++t){var i=this.dataSource()[t];i.lastCheck&&e-i.lastCheck>this.maxAbsenseInterval&&(i.softExpiration+=e-i.lastCheck),i.lastCheck=e,i.hardExpiration-e>this.maxExpirationInterval&&(i.hardExpiration=e+this.maxExpirationInterval),i.softExpiration-e>this.maxExpirationInterval&&(i.softExpiration=e+this.maxExpirationInterval),this.onExpirationChange&&this.onExpirationChange(i),i.softExpiration>e&&i.hardExpiration>e||i.lastError&&e-i.lastError<this.minRetryInterval||this._download(i,0)}},cancel:function(){this._timer.cancel()},isDownloading:function(e){return e in this._downloading},download:function(e){t.runAsync(this._download.bind(this,e,0))},getDownloadUrl:function(e){var t=require("info"),i=t.addonName,r=t.addonVersion,n=t.application,s=t.applicationVersion,o=t.platform,a=t.platformVersion,l=e.redirectURL||e.url;return l+=l.indexOf("?")>=0?"&":"?",l+="addonName="+encodeURIComponent(i)+"&addonVersion="+encodeURIComponent(r)+"&application="+encodeURIComponent(n)+"&applicationVersion="+encodeURIComponent(s)+"&platform="+encodeURIComponent(o)+"&platformVersion="+encodeURIComponent(a)+"&lastVersion="+encodeURIComponent(e.lastVersion)+"&t="+Date.now()},_download:function(e,t){if(!(e.url in this._downloading)){var i=this.getDownloadUrl(e),r=null,n=function(n){var s=-1;try{s=r.channel.status}catch(o){}var a=r.status;if(Cu.reportError("Adblock Plus: Downloading URL "+e.url+" failed ("+n+")\nDownload address: "+i+"\nChannel status: "+s+"\nServer response: "+a),this.onDownloadError){var l=null;t<=this.maxRedirects&&(l=function(i){e.redirectURL=i,this._download(e,t+1)}.bind(this)),this.onDownloadError(e,i,n,s,a,l)}}.bind(this);try{r=new XMLHttpRequest,r.mozBackgroundRequest=!0,r.open("GET",i)}catch(s){return void n("synchronize_invalid_url")}try{r.overrideMimeType("text/plain"),r.channel.loadFlags=r.channel.loadFlags|r.channel.INHIBIT_CACHING|r.channel.VALIDATE_ALWAYS,r.channel instanceof Ci.nsIHttpChannel&&(r.channel.redirectionLimit=this.maxRedirects)}catch(s){Cu.reportError(s)}r.addEventListener("error",function(t){onShutdown.done||(delete this._downloading[e.url],n("synchronize_connection_error"))}.bind(this),!1),r.addEventListener("load",function(i){if(!onShutdown.done)return delete this._downloading[e.url],r.status&&200!=r.status?void n("synchronize_connection_error"):void this.onDownloadSuccess(e,r.responseText,n,function(i){t>=this.maxRedirects?n("synchronize_connection_error"):(e.redirectURL=i,this._download(e,t+1))}.bind(this))}.bind(this),!1),this._downloading[e.url]=!0,this.onDownloadStarted&&this.onDownloadStarted(e),r.send(null)}},processExpirationInterval:function(e){e=Math.min(Math.max(e,0),this.maxExpirationInterval);var t=Math.round(e*(.4*Math.random()+.8)),i=2*e,r=Date.now();return[r+t,r+i]}};var a=e.Downloadable=function(e){this.url=e};return a.prototype={url:null,redirectURL:null,lastError:0,lastCheck:0,lastVersion:0,softExpiration:0,hardExpiration:0},e}(),require.scopes.filterNotifier=function(){var e={},t=[];e.FilterNotifier={addListener:function(e){t.indexOf(e)>=0||t.push(e)},removeListener:function(e){var i=t.indexOf(e);i>=0&&t.splice(i,1)},triggerListeners:function(e,i,r,n,s){for(var o=0;o<t.length;++o){var a=t[o];a(e,i,r,n,s)}}};return e}(),require.scopes.filterClasses=function(){function e(e){this.text=e,this.subscriptions=[]}function t(t,i){e.call(this,t),this.reason=i}function i(t){e.call(this,t)}function r(t,i){e.call(this,t),this.domainSource=i}function n(e,t,i,n,s,o){if(r.call(this,e,s),null!=i&&(this.contentType=i),n&&(this.matchCase=n),null!=o&&(this.thirdParty=o),t.length>=2&&"/"==t[0]&&"/"==t[t.length-1]){var a=new RegExp(t.substr(1,t.length-2),this.matchCase?"":"i");this.__defineGetter__("regexp",function(){return a})}else this.regexpSource=t}function s(e,t,i,r,s,o,a){n.call(this,e,t,i,r,s,o),this.collapse=a}function o(e,t,i,r,s,o,a,l,u){n.call(this,e,t,i,r,s,o),this.collapse=a,this.replace=l,this.keyword=u,this.redirect=function(e){var t=e.replace(this.regexp,l);return t}}function a(e,t,i,r,s,o,a){n.call(this,e,t,i,r,s,o),null!=a&&(this.siteKeys=a)}function l(e,t,i){r.call(this,e,t?t.toUpperCase():null),t&&(this.selectorDomain=t.replace(/,~[^,]+/g,"").replace(/^~[^,]+,?/,"").toLowerCase()),this.selector=i}function u(e,t,i){l.call(this,e,t,i)}function c(e,t,i){l.call(this,e,t,i)}var f={},d=require("filterNotifier").FilterNotifier;return f.Filter=e,e.prototype={text:null,subscriptions:null,serialize:function(e){e.push("[Filter]"),e.push("text="+this.text)},toString:function(){return this.text}},e.knownFilters={__proto__:null},e.elemhideRegExp=/^([^\/\*\|\@"!]*?)#(\@)?(?:([\w\-]+|\*)((?:\([\w\-]+(?:[$^*]?=[^\(\)"]*)?\))*)|#([^{}]+))$/,e.regexpRegExp=/^(@@)?\/.*\/(?:\$~?[\w\-]+(?:=[^,\s]+)?(?:,~?[\w\-]+(?:=[^,\s]+)?)*)?$/,e.optionsRegExp=/\$(~?[\w\-]+(?:=[^,\s]+)?(?:,~?[\w\-]+(?:=[^,\s]+)?)*)$/,e.fromText=function(t){if(t in e.knownFilters)return e.knownFilters[t];var r,s=t.indexOf("#")>=0?e.elemhideRegExp.exec(t):null;return r=s?l.fromText(t,s[1],s[2],s[3],s[4],s[5]):"!"==t[0]?new i(t):n.fromText(t),e.knownFilters[r.text]=r,r},e.fromObject=function(t){var i=e.fromText(t.text);return i instanceof r&&("disabled"in t&&(i._disabled="true"==t.disabled),"hitCount"in t&&(i._hitCount=parseInt(t.hitCount)||0),"lastHit"in t&&(i._lastHit=parseInt(t.lastHit)||0)),i},e.normalize=function(t){if(!t)return t;if(t=t.replace(/[^\S ]/g,""),/^\s*!/.test(t))return t.replace(/^\s+/,"").replace(/\s+$/,"");if(e.elemhideRegExp.test(t)){var i=/^(.*?)(#\@?#?)(.*)$/.exec(t),r=i[1],n=i[2],s=i[3];return r.replace(/\s/g,"")+n+s.replace(/^\s+/,"").replace(/\s+$/,"")}return t.replace(/\s/g,"")},f.InvalidFilter=t,t.prototype={__proto__:e.prototype,reason:null,serialize:function(e){}},f.CommentFilter=i,i.prototype={__proto__:e.prototype,serialize:function(e){}},f.ActiveFilter=r,r.prototype={__proto__:e.prototype,_disabled:!1,_hitCount:0,_lastHit:0,get disabled(){return this._disabled},set disabled(e){if(e!=this._disabled){var t=this._disabled;this._disabled=e,d.triggerListeners("filter.disabled",this,e,t)}return this._disabled},get hitCount(){return this._hitCount},set hitCount(e){if(e!=this._hitCount){var t=this._hitCount;this._hitCount=e,d.triggerListeners("filter.hitCount",this,e,t)}return this._hitCount},get lastHit(){return this._lastHit},set lastHit(e){if(e!=this._lastHit){var t=this._lastHit;this._lastHit=e,d.triggerListeners("filter.lastHit",this,e,t)}return this._lastHit},domainSource:null,domainSeparator:null,ignoreTrailingDot:!0,get domains(){var e=null;if(this.domainSource){var t=this.domainSource.split(this.domainSeparator);if(1==t.length&&"~"!=t[0][0])e={__proto__:null,"":!1},this.ignoreTrailingDot&&(t[0]=t[0].replace(/\.+$/,"")),e[t[0]]=!0;else{for(var i=!1,r=0;r<t.length;r++){var n=t[r];if(this.ignoreTrailingDot&&(n=n.replace(/\.+$/,"")),""!=n){var s;"~"==n[0]?(s=!1,n=n.substr(1)):(s=!0,i=!0),e||(e={__proto__:null}),e[n]=s}}e[""]=!i}delete this.domainSource}return this.__defineGetter__("domains",function(){return e}),this.domains},isActiveOnDomain:function(e){if(!this.domains)return!0;if(!e)return this.domains[""];for(this.ignoreTrailingDot&&(e=e.replace(/\.+$/,"")),e=e.toUpperCase();;){if(e in this.domains)return this.domains[e];var t=e.indexOf(".");if(t<0)break;e=e.substr(t+1)}return this.domains[""]},isActiveOnlyOnDomain:function(e){if(!e||!this.domains||this.domains[""])return!1;this.ignoreTrailingDot&&(e=e.replace(/\.+$/,"")),e=e.toUpperCase();for(var t in this.domains)if(this.domains[t]&&t!=e&&(t.length<=e.length||t.indexOf("."+e)!=t.length-e.length-1))return!1;return!0},serialize:function(t){(this._disabled||this._hitCount||this._lastHit)&&(e.prototype.serialize.call(this,t),this._disabled&&t.push("disabled=true"),this._hitCount&&t.push("hitCount="+this._hitCount),this._lastHit&&t.push("lastHit="+this._lastHit))}},f.RegExpFilter=n,n.prototype={__proto__:r.prototype,length:1,domainSeparator:"|",regexpSource:null,get regexp(){var e=this.regexpSource.replace(/\*+/g,"*");"*"==e[0]&&(e=e.substr(1));var t=e.length-1;t>=0&&"*"==e[t]&&(e=e.substr(0,t)),e=e.replace(/\^\|$/,"^").replace(/\W/g,"\\$&").replace(/\\\*/g,".*").replace(/\\\^/g,"(?:[\\x00-\\x24\\x26-\\x2C\\x2F\\x3A-\\x40\\x5B-\\x5E\\x60\\x7B-\\x80]|$)").replace(/^\\\|\\\|/,"^[\\w\\-]+:\\/+(?!\\/)(?:[^.\\/]+\\.)*?").replace(/^\\\|/,"^").replace(/\\\|$/,"$");var i=new RegExp(e,this.matchCase?"":"i");return delete this.regexpSource,this.__defineGetter__("regexp",function(){return i}),this.regexp},contentType:2147483647,matchCase:!1,thirdParty:null,matches:function(e,t,i,r){return!(!this.regexp.test(e)||0==(n.typeMap[t]&this.contentType)||null!=this.thirdParty&&this.thirdParty!=r||!this.isActiveOnDomain(i))}},n.prototype.__defineGetter__("0",function(){return this}),n.fromText=function(i){var r=!0,l=i;0==i.indexOf("@@")&&(r=!1,i=i.substr(2));var u,c=null,f=null,d=null,p=null,h=null,_=null,b=i.indexOf(">>>");if(b>=0){var v=l.substring(0,b),g=i.indexOf(">>>>"),w=l.substring(b+3,g),m=l.substring(g+4).split(","),y=m[0].split("=")[1];return new o(l,v,c,f,d,h,_,w,y)}var S=i.indexOf("$")>=0?e.optionsRegExp.exec(i):null;if(S){u=S[1].toUpperCase().split(","),i=S.input.substr(0,S.index);for(var x=0;x<u.length;++x){var E=u[x],C=null,k=E.indexOf("=");if(k>=0&&(C=E.substr(k+1),E=E.substr(0,k)),E=E.replace(/-/,"_"),E in n.typeMap)null==c&&(c=0),c|=n.typeMap[E];else if("~"==E[0]&&E.substr(1)in n.typeMap)null==c&&(c=n.prototype.contentType),c&=~n.typeMap[E.substr(1)];else if("MATCH_CASE"==E)f=!0;else if("~MATCH_CASE"==E)f=!1;else if("DOMAIN"==E&&"undefined"!=typeof C)d=C;else if("THIRD_PARTY"==E)h=!0;else if("~THIRD_PARTY"==E)h=!1;else if("COLLAPSE"==E)_=!0;else if("~COLLAPSE"==E)_=!1;else{if("SITEKEY"!=E||"undefined"==typeof C)return new t(l,"Unknown option "+E.toLowerCase());p=C.split(/\|/)}}}r||!(null==c||c&n.typeMap.DOCUMENT)||u&&!(u.indexOf("DOCUMENT")<0)||/^\|?[\w\-]+:/.test(i)||(null==c&&(c=n.prototype.contentType),c&=~n.typeMap.DOCUMENT),!r&&p&&(c=n.typeMap.DOCUMENT);try{return r?new s(l,i,c,f,d,h,_):new a(l,i,c,f,d,h,p)}catch(F){return new t(l,F)}},n.typeMap={OTHER:1,SCRIPT:2,IMAGE:4,STYLESHEET:8,OBJECT:16,SUBDOCUMENT:32,DOCUMENT:64,XBL:1,PING:1,XMLHTTPREQUEST:2048,OBJECT_SUBREQUEST:4096,DTD:1,MEDIA:16384,FONT:32768,BACKGROUND:4,POPUP:268435456,ELEMHIDE:1073741824},n.prototype.contentType&=~(n.typeMap.ELEMHIDE|n.typeMap.POPUP),f.BlockingFilter=s,s.prototype={__proto__:n.prototype,collapse:null},f.RedirectFilter=o,o.prototype={__proto__:n.prototype,collapse:null,replace:null},f.WhitelistFilter=a,a.prototype={__proto__:n.prototype,siteKeys:null},f.ElemHideBase=l,l.prototype={__proto__:r.prototype,domainSeparator:",",ignoreTrailingDot:!1,selectorDomain:null,selector:null},l.fromText=function(e,i,r,n,s,o){if(!o){"*"==n&&(n="");var a=null,l="";if(s){s=s.match(/\([\w\-]+(?:[$^*]?=[^\(\)"]*)?\)/g);for(var f=0;f<s.length;++f){var d=s[f];d=d.substr(1,d.length-2);var p=d.indexOf("=");if(p>0)d=d.replace(/=/,'="')+'"',l+="["+d+"]";else{if(a){var h=require("utils").Utils;return new t(e,h.getString("filter_elemhide_duplicate_id"))}a=d}}}if(a)o=n+"."+a+l+","+n+"#"+a+l;else{if(!n&&!l){var h=require("utils").Utils;return new t(e,h.getString("filter_elemhide_nocriteria"))}o=n+l}}return r?new c(e,i,o):new u(e,i,o)},f.ElemHideFilter=u,u.prototype={__proto__:l.prototype},f.ElemHideException=c,c.prototype={__proto__:l.prototype},f}(),require.scopes.subscriptionClasses=function(){function e(t,i){if(this.url=t,this.filters=[],i)this._title=i;else{var r=require("utils").Utils;this._title=r.getString("newGroup_title")}e.knownSubscriptions[t]=this}function t(t,i){e.call(this,t,i)}function i(t,i){e.call(this,t,i||t)}function r(e,t){i.call(this,e,t)}function n(e,t){i.call(this,e,t)}var s={},o=require("filterClasses"),a=o.ActiveFilter,l=o.BlockingFilter,u=o.WhitelistFilter,c=o.ElemHideBase,f=require("filterNotifier").FilterNotifier;return s.Subscription=e,e.prototype={url:null,filters:null,_title:null,_fixedTitle:!1,_disabled:!1,get title(){return this._title},set title(e){if(e!=this._title){var t=this._title;this._title=e,f.triggerListeners("subscription.title",this,e,t)}return this._title},get fixedTitle(){return this._fixedTitle},set fixedTitle(e){if(e!=this._fixedTitle){var t=this._fixedTitle;this._fixedTitle=e,f.triggerListeners("subscription.fixedTitle",this,e,t)}return this._fixedTitle},get disabled(){return this._disabled},set disabled(e){if(e!=this._disabled){var t=this._disabled;this._disabled=e,f.triggerListeners("subscription.disabled",this,e,t)}return this._disabled},serialize:function(e){e.push("[Subscription]"),e.push("url="+this.url),e.push("title="+this._title),this._fixedTitle&&e.push("fixedTitle=true"),this._disabled&&e.push("disabled=true")},serializeFilters:function(e){for(var t=0;t<this.filters.length;++t){var i=this.filters[t];e.push(i.text.replace(/\[/g,"\\["))}},toString:function(){var e=[];return this.serialize(e),e.join("\n")}},e.knownSubscriptions={__proto__:null},e.fromURL=function(i){if(i in e.knownSubscriptions)return e.knownSubscriptions[i];try{return i=Services.io.newURI(i,null,null).spec,new n(i,null)}catch(r){return new t(i)}},e.fromObject=function(e){var i;try{if(e.url=Services.io.newURI(e.url,null,null).spec,i=new n(e.url,e.title),"downloadStatus"in e&&(i._downloadStatus=e.downloadStatus),"lastSuccess"in e&&(i.lastSuccess=parseInt(e.lastSuccess)||0),"lastCheck"in e&&(i._lastCheck=parseInt(e.lastCheck)||0),"expires"in e&&(i.expires=parseInt(e.expires)||0),"softExpiration"in e&&(i.softExpiration=parseInt(e.softExpiration)||0),"errors"in e&&(i._errors=parseInt(e.errors)||0),"version"in e&&(i.version=parseInt(e.version)||0),"requiredVersion"in e){var r=require("info").addonVersion;i.requiredVersion=e.requiredVersion,Services.vc.compare(i.requiredVersion,r)>0&&(i.upgradeRequired=!0)}"homepage"in e&&(i._homepage=e.homepage),"lastDownload"in e&&(i._lastDownload=parseInt(e.lastDownload)||0)}catch(s){if(!("title"in e)&&("~wl~"==e.url?e.defaults="whitelist":"~fl~"==e.url?e.defaults="blocking":"~eh~"==e.url&&(e.defaults="elemhide"),"defaults"in e)){var o=require("utils").Utils;e.title=o.getString(e.defaults+"Group_title")}i=new t(e.url,e.title),"defaults"in e&&(i.defaults=e.defaults.split(" "))}return"fixedTitle"in e&&(i._fixedTitle="true"==e.fixedTitle),"disabled"in e&&(i._disabled="true"==e.disabled),i},s.SpecialSubscription=t,t.prototype={__proto__:e.prototype,defaults:null,isDefaultFor:function(e){if(this.defaults&&this.defaults.length)for(var i=0;i<this.defaults.length;++i){var r=this.defaults[i];if(e instanceof t.defaultsMap[r])return!0;if(!(e instanceof a)&&"blacklist"==r)return!0}return!1},serialize:function(i){e.prototype.serialize.call(this,i),this.defaults&&this.defaults.length&&i.push("defaults="+this.defaults.filter(function(e){return e in t.defaultsMap}).join(" ")),this._lastDownload&&i.push("lastDownload="+this._lastDownload)}},t.defaultsMap={__proto__:null,whitelist:u,blocking:l,elemhide:c},t.create=function(i){var r;do r="~user~"+Math.round(1e6*Math.random());while(r in e.knownSubscriptions);return new t(r,i)},t.createForFilter=function(e){var i=t.create();i.filters.push(e);for(var r in t.defaultsMap)e instanceof t.defaultsMap[r]&&(i.defaults=[r]);i.defaults||(i.defaults=["blocking"]);var n=require("utils").Utils;return i.title=n.getString(i.defaults[0]+"Group_title"),i},s.RegularSubscription=i,i.prototype={__proto__:e.prototype,_homepage:null,_lastDownload:0,get homepage(){return this._homepage},set homepage(e){if(e!=this._homepage){var t=this._homepage;this._homepage=e,f.triggerListeners("subscription.homepage",this,e,t)}return this._homepage},get lastDownload(){return this._lastDownload},set lastDownload(e){if(e!=this._lastDownload){var t=this._lastDownload;this._lastDownload=e,f.triggerListeners("subscription.lastDownload",this,e,t)}return this._lastDownload},serialize:function(t){e.prototype.serialize.call(this,t),this._homepage&&t.push("homepage="+this._homepage),this._lastDownload&&t.push("lastDownload="+this._lastDownload)}},s.ExternalSubscription=r,r.prototype={__proto__:i.prototype,serialize:function(e){throw new Error("Unexpected call, external subscriptions should not be serialized")}},s.DownloadableSubscription=n,n.prototype={__proto__:i.prototype,_downloadStatus:null,_lastCheck:0,_errors:0,get downloadStatus(){return this._downloadStatus},set downloadStatus(e){var t=this._downloadStatus;return this._downloadStatus=e,f.triggerListeners("subscription.downloadStatus",this,e,t),this._downloadStatus},lastSuccess:0,get lastCheck(){return this._lastCheck},set lastCheck(e){if(e!=this._lastCheck){var t=this._lastCheck;this._lastCheck=e,f.triggerListeners("subscription.lastCheck",this,e,t)}return this._lastCheck},expires:0,softExpiration:0,get errors(){return this._errors},set errors(e){if(e!=this._errors){var t=this._errors;this._errors=e,f.triggerListeners("subscription.errors",this,e,t)}return this._errors},version:0,requiredVersion:null,upgradeRequired:!1,serialize:function(e){i.prototype.serialize.call(this,e),this.downloadStatus&&e.push("downloadStatus="+this.downloadStatus),this.lastSuccess&&e.push("lastSuccess="+this.lastSuccess),this.lastCheck&&e.push("lastCheck="+this.lastCheck),this.expires&&e.push("expires="+this.expires),this.softExpiration&&e.push("softExpiration="+this.softExpiration),this.errors&&e.push("errors="+this.errors),this.version&&e.push("version="+this.version),this.requiredVersion&&e.push("requiredVersion="+this.requiredVersion)}},s}(),require.scopes.filterStorage=function(){function e(e){if(e.url in _.knownSubscriptions)for(var t=0;t<e.filters.length;++t){var i=e.filters[t];i.subscriptions.push(e)}}function t(e){if(e.url in _.knownSubscriptions)for(var t=0;t<e.filters.length;++t){var i=e.filters[t],r=i.subscriptions.indexOf(e);r>=0&&i.subscriptions.splice(r,1)}}function i(){this.fileProperties=this.curObj={},this.subscriptions=[],this.knownFilters={__proto__:null},this.knownSubscriptions={__proto__:null}}var r={},n=require("io").IO,s=require("prefs").Prefs,o=require("filterClasses"),a=o.Filter,l=o.ActiveFilter,u=require("subscriptionClasses"),c=u.Subscription,f=u.SpecialSubscription,d=u.ExternalSubscription,p=require("filterNotifier").FilterNotifier,h=4,_=r.FilterStorage={get formatVersion(){return h},get sourceFile(){var e=null;if(s.patternsfile&&(e=n.resolveFilePath(s.patternsfile)),e||(e=n.resolveFilePath(s.data_directory),e&&e.append("patterns.ini")),!e)try{e=n.resolveFilePath(Services.prefs.getDefaultBranch("extensions.adblockplus.").getCharPref("data_directory")),e&&e.append("patterns.ini")}catch(t){}return e||Cu.reportError("Adblock Plus: Failed to resolve filter file location from extensions.adblockplus.patternsfile preference"),this.__defineGetter__("sourceFile",function(){return e}),this.sourceFile},fileProperties:{__proto__:null},subscriptions:[],knownSubscriptions:{__proto__:null},getGroupForFilter:function(e){for(var t=null,i=0;i<_.subscriptions.length;++i){var r=_.subscriptions[i];if(r instanceof f&&!r.disabled){if(r.isDefaultFor(e))return r;t||r.defaults&&r.defaults.length||(t=r)}}return t},addSubscription:function(t,i){t.url in _.knownSubscriptions||(_.subscriptions.push(t),_.knownSubscriptions[t.url]=t,e(t),i||p.triggerListeners("subscription.added",t))},removeSubscription:function(e,i){for(var r=0;r<_.subscriptions.length;r++)if(_.subscriptions[r].url==e.url)return t(e),_.subscriptions.splice(r--,1),delete _.knownSubscriptions[e.url],void(i||p.triggerListeners("subscription.removed",e))},moveSubscription:function(e,t){var i=_.subscriptions.indexOf(e);if(!(i<0)){var r=t?_.subscriptions.indexOf(t):-1;r<0&&(r=_.subscriptions.length),i<r&&r--,i!=r&&(_.subscriptions.splice(i,1),_.subscriptions.splice(r,0,e),p.triggerListeners("subscription.moved",e))}},updateSubscriptionFilters:function(i,r){t(i),i.oldFilters=i.filters,i.filters=r,e(i),p.triggerListeners("subscription.updated",i),delete i.oldFilters},addFilter:function(e,t,i,r){if(!t){if(e.subscriptions.some(function(e){return e instanceof f&&!e.disabled}))return;t=_.getGroupForFilter(e)}return t?("undefined"==typeof i&&(i=t.filters.length),e.subscriptions.indexOf(t)<0&&e.subscriptions.push(t),t.filters.splice(i,0,e),void(r||p.triggerListeners("filter.added",e,t,i))):(t=f.createForFilter(e),void this.addSubscription(t))},removeFilter:function(e,t,i){for(var r=t?[t]:e.subscriptions.slice(),n=0;n<r.length;n++){var t=r[n];if(t instanceof f){var s=[];if("undefined"==typeof i){var o=-1;do o=t.filters.indexOf(e,o+1),o>=0&&s.push(o);while(o>=0)}else s.push(i);for(var a=s.length-1;a>=0;a--){var i=s[a];if(t.filters[i]==e){if(t.filters.splice(i,1),t.filters.indexOf(e)<0){var o=e.subscriptions.indexOf(t);o>=0&&e.subscriptions.splice(o,1)}p.triggerListeners("filter.removed",e,t,i)}}}}},moveFilter:function(e,t,i,r){t instanceof f&&t.filters[i]==e&&(r=Math.min(Math.max(r,0),t.filters.length-1),i!=r&&(t.filters.splice(i,1),t.filters.splice(r,0,e),p.triggerListeners("filter.moved",e,t,i,r)))},increaseHitCount:function(e,t){s.savestats&&!b.enabledForWindow(t)&&!b.enabled&&e instanceof l&&(e.hitCount++,e.lastHit=Date.now())},resetHitCounts:function(e){if(!e){e=[];for(var t in a.knownFilters)e.push(a.knownFilters[t])}for(var i=0;i<e.length;++i){var r=e[i];r.hitCount=0,r.lastHit=0}},_loading:!1,loadFromDisk:function(e){if(!this._loading){var t,r=function(e,o){var a=new i;n.readFromFile(e,!0,a,function(i){if(i||0!=a.subscriptions.length||(i=new Error("No data in the file")),i&&Cu.reportError(i),i&&!t&&(e=this.sourceFile)){var l=/^(.*)(\.\w+)$/.exec(e.leafName)||[null,e.leafName,""],u=l[1],c=l[2];return e=e.clone(),e.leafName=u+"-backup"+ ++o+c,void n.statFile(e,function(t,i){!t&&i.exists?r(e,o):s(a)})}s(a)}.bind(this),"FilterStorageRead")}.bind(this),s=function(t){for(var i={"~il~":!0,"~wl~":!0,"~fl~":!0,"~eh~":!0},r={__proto__:null},n=0;n<t.subscriptions.length;n++){var s=t.subscriptions[n];s instanceof f&&0==s.filters.length&&s.url in i?t.subscriptions.splice(n--,1):r[s.url]=s}if(this.fileProperties=t.fileProperties,this.subscriptions=t.subscriptions,this.knownSubscriptions=r,a.knownFilters=t.knownFilters,c.knownSubscriptions=t.knownSubscriptions,t.userFilters)for(var n=0;n<t.userFilters.length;n++){var o=a.fromText(t.userFilters[n]);this.addFilter(o,null,void 0,!0)}this._loading=!1,p.triggerListeners("load"),e!=this.sourceFile&&this.saveToDisk()}.bind(this),o=function(e){this._loading=!0,r(e,0)}.bind(this);if(e)t=!0,o(e);else{t=!1,e=_.sourceFile;var l=function(t,i){if(t||!i.exists){var r=require("info").addonRoot;e=Services.io.newURI(r+"defaults/patterns.ini",null,null)}o(e)};e?n.statFile(e,l):l(!0)}}},_generateFilterData:function(e){var t=[];t.push("# Adblock Plus preferences"),t.push("version="+h);for(var i={__proto__:null},r=[],n=0;n<e.length;n++)for(var s=e[n],o=0;o<s.filters.length;o++){var a=s.filters[o];if(!(a.text in i)){a.serialize(r),i[a.text]=a;for(var l=0;l<r.length;l++)t.push(r[l]);r.splice(0)}}for(var n=0;n<e.length;n++){var s=e[n];t.push(""),s.serialize(r),s.filters.length&&(r.push("","[Subscription filters]"),s.serializeFilters(r));for(var l=0;l<r.length;l++)t.push(r[l]);r.splice(0)}return t},_saving:!1,_needsSave:!1,saveToDisk:function(e){var t=!0;if(e||(e=_.sourceFile,t=!1),e){if(!t&&this._saving)return void(this._needsSave=!0);try{e.parent.create(Ci.nsIFile.DIRECTORY_TYPE,FileUtils.PERMS_DIRECTORY)}catch(i){}var r=function(){n.writeToFile(e,!0,this._generateFilterData(u),function(e){t||(this._saving=!1),e&&Cu.reportError(e),!t&&this._needsSave?(this._needsSave=!1,this.saveToDisk()):p.triggerListeners("save")}.bind(this),"FilterStorageWrite")}.bind(this),o=function(i,r){t||s.patternsbackups<=0?i():n.statFile(e,function(t,o){if(t||!o.exists)i();else{var a=/^(.*)(\.\w+)$/.exec(e.leafName)||[null,e.leafName,""],l=a[1],u=a[2],c=e.clone();c.leafName=l+"-backup1"+u,n.statFile(c,function(e,t){e||t.exists&&!((Date.now()-t.lastModified)/36e5>=s.patternsbackupinterval)?i():r(l,u)})}})}.bind(this),a=function(t,i){var r=e.clone();r.leafName=t+"-backup"+s.patternsbackups+i,n.removeFile(r,function(e){return l(t,i,s.patternsbackups-1)})}.bind(this),l=function(t,i,s){if(s>0){var o=e.clone();o.leafName=t+"-backup"+s+i;var a=t+"-backup"+(s+1)+i;n.renameFile(o,a,function(e){return l(t,i,s-1)})}else{var u=e.clone();u.leafName=t+"-backup"+(s+1)+i,n.copyFile(e,u,r)}}.bind(this),u=this.subscriptions.filter(function(e){return!(e instanceof d)});t||(this._saving=!0),o(r,a)}},getBackupFiles:function(){for(var e=[],t=/^(.*)(\.\w+)$/.exec(_.sourceFile.leafName)||[null,_.sourceFile.leafName,""],i=t[1],r=t[2],n=1;;n++){var s=_.sourceFile.clone();if(s.leafName=i+"-backup"+n+r,!s.exists())break;e.push(s)}return e}},b=r.PrivateBrowsing={enabled:!1,enabledForWindow:function(e){try{return e.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsILoadContext).usePrivateBrowsing}catch(t){return t.result!=Cr.NS_NOINTERFACE&&Cu.reportError(t),!1}},init:function(){if("@mozilla.org/privatebrowsing;1"in Cc)try{this.enabled=Cc["@mozilla.org/privatebrowsing;1"].getService(Ci.nsIPrivateBrowsingService).privateBrowsingEnabled,Services.obs.addObserver(this,"private-browsing",!0),onShutdown.add(function(){Services.obs.removeObserver(this,"private-browsing")}.bind(this))}catch(e){Cu.reportError(e)}},observe:function(e,t,i){"private-browsing"==t&&("enter"==i?this.enabled=!0:"exit"==i&&(this.enabled=!1))},QueryInterface:XPCOMUtils.generateQI([Ci.nsISupportsWeakReference,Ci.nsIObserver])};return b.init(),i.prototype={subscriptions:null,knownFilters:null,knownSubscrptions:null,wantObj:!0,fileProperties:null,curObj:null,curSection:null,userFilters:null,process:function(e){var t=a.knownFilters;a.knownFilters=this.knownFilters;var i=c.knownSubscriptions;c.knownSubscriptions=this.knownSubscriptions;var r;try{if(this.wantObj===!0&&(r=/^(\w+)=(.*)$/.exec(e)))this.curObj[r[1]]=r[2];else if(null===e||(r=/^\s*\[(.+)\]\s*$/.exec(e))){if(this.curObj)switch(this.curSection){case"filter":case"pattern":"text"in this.curObj&&a.fromObject(this.curObj);break;case"subscription":var n=c.fromObject(this.curObj);n&&this.subscriptions.push(n);break;case"subscription filters":case"subscription patterns":if(this.subscriptions.length)for(var n=this.subscriptions[this.subscriptions.length-1],s=0;s<this.curObj.length;++s){var o=this.curObj[s],l=a.fromText(o);n.filters.push(l),l.subscriptions.push(n)}break;case"user patterns":this.userFilters=this.curObj}if(null===e)return;switch(this.curSection=r[1].toLowerCase(),this.curSection){case"filter":case"pattern":case"subscription":this.wantObj=!0,this.curObj={};break;case"subscription filters":case"subscription patterns":case"user patterns":this.wantObj=!1,this.curObj=[];break;default:this.wantObj=void 0,this.curObj=null}}else this.wantObj===!1&&e&&this.curObj.push(e.replace(/\\\[/g,"["))}finally{a.knownFilters=t,c.knownSubscriptions=i}}},r}(),require.scopes.elemHide=function(){var e={},t=require("utils").Utils,i=require("io").IO,r=require("prefs").Prefs,n=require("filterClasses").ElemHideException,s=require("filterNotifier").FilterNotifier,o=require("elemHideHitRegistration").AboutHandler,a={__proto__:null},l={__proto__:null},u={__proto__:null},c={__proto__:null},f=null,d=e.ElemHide={isDirty:!1,applied:!1,init:function(){r.addListener(function(e){"enabled"==e&&d.apply()}),onShutdown.add(function(){d.unapply()});var e=i.resolveFilePath(r.data_directory);e.append("elemhide.css"),f=Services.io.newFileURI(e).QueryInterface(Ci.nsIFileURL)},clear:function(){a={__proto__:null},l={__proto__:null},u={__proto__:null},c={__proto__:null},d.isDirty=!1,d.unapply()},add:function(e){if(e instanceof n){if(e.text in u)return;var t=e.selector;t in c||(c[t]=[]),c[t].push(e),u[e.text]=!0}else{if(e.text in l)return;var i;do i=Math.random().toFixed(15).substr(5);while(i in a);a[i]=e,l[e.text]=i,d.isDirty=!0}},remove:function(e){if(e instanceof n){if(!(e.text in u))return;var t=c[e.selector],i=t.indexOf(e);i>=0&&t.splice(i,1),delete u[e.text]}else{if(!(e.text in l))return;var r=l[e.text];delete a[r],delete l[e.text],d.isDirty=!0}},getException:function(e,t){e.selector;if(!(e.selector in c))return null;for(var i=c[e.selector],r=i.length-1;r>=0;r--)if(i[r].isActiveOnDomain(t))return i[r];return null},_applying:!1,_needsApply:!1,apply:function(){if(this._applying)return void(this._needsApply=!0);if(d.isDirty&&r.enabled)i.writeToFile(f.file,!1,this._generateCSSContent(),function(e){if(this._applying=!1,e&&e.result==Cr.NS_ERROR_NOT_AVAILABLE?i.removeFile(f.file,function(e){}):e&&Cu.reportError(e),this._needsApply)this._needsApply=!1,this.apply();else if(!e||e.result==Cr.NS_ERROR_NOT_AVAILABLE){if(d.isDirty=!1,d.unapply(),!e)try{t.styleService.loadAndRegisterSheet(f,Ci.nsIStyleSheetService.USER_SHEET),d.applied=!0}catch(e){Cu.reportError(e)}s.triggerListeners("elemhideupdate")}}.bind(this),"ElemHideWrite"),this._applying=!0;else if(r.enabled&&!d.applied)try{t.styleService.loadAndRegisterSheet(f,Ci.nsIStyleSheetService.USER_SHEET),d.applied=!0}catch(e){Cu.reportError(e)}else!r.enabled&&d.applied&&d.unapply()},_generateCSSContent:function(){function e(e){return"\\"+e.charCodeAt(0).toString(16)+" "}var t=[],i={__proto__:null},r=!1;for(var n in a){var s,l=a[n],u=l.selectorDomain||"";
u in i?s=i[u]:(s={__proto__:null},i[u]=s),s[l.selector]=n,r=!0}if(!r)throw Cr.NS_ERROR_NOT_AVAILABLE;var c="-moz-binding: url(about:"+o.aboutPrefix+"?%ID%#dummy) !important;";for(var u in i){var s=i[u];u?t.push(('@-moz-document domain("'+u.split(",").join('"),domain("')+'"){').replace(/[^\x01-\x7F]/g,e)):t.push('@-moz-document url-prefix("http://"),url-prefix("https://"),url-prefix("mailbox://"),url-prefix("imap://"),url-prefix("news://"),url-prefix("snews://"){');for(var f in s)t.push(f.replace(/[^\x01-\x7F]/g,e)+"{"+c.replace("%ID%",s[f])+"}");t.push("}")}return t},unapply:function(){if(d.applied){try{t.styleService.unregisterSheet(f,Ci.nsIStyleSheetService.USER_SHEET)}catch(e){Cu.reportError(e)}d.applied=!1}},get styleURL(){return d.applied?f.spec:null},getFilterByKey:function(e){return e in a?a[e]:null},getSelectorsForDomain:function(e,t){var i=[];for(var r in a){var n=a[r];(!t||n.domains&&!n.domains[""])&&n.isActiveOnDomain(e)&&!this.getException(n,e)&&i.push(n.selector)}return i}};return e}(),require.scopes.matcher=function(){function e(){this.clear()}function t(){this.blacklist=new e,this.whitelist=new e,this.keys={__proto__:null},this.resultCache={__proto__:null}}var i={},r=require("filterClasses"),n=r.Filter,s=(r.RegExpFilter,r.WhitelistFilter);i.Matcher=e,e.prototype={filterByKeyword:null,keywordByFilter:null,clear:function(){this.filterByKeyword={__proto__:null},this.keywordByFilter={__proto__:null}},add:function(e){if(!(e.text in this.keywordByFilter)){var t=this.findKeyword(e),i=this.filterByKeyword[t];"undefined"==typeof i?this.filterByKeyword[t]=e:1==i.length?this.filterByKeyword[t]=[i,e]:i.push(e),this.keywordByFilter[e.text]=t}},remove:function(e){if(e.text in this.keywordByFilter){var t=this.keywordByFilter[e.text],i=this.filterByKeyword[t];if(i.length<=1)delete this.filterByKeyword[t];else{var r=i.indexOf(e);r>=0&&(i.splice(r,1),1==i.length&&(this.filterByKeyword[t]=i[0]))}delete this.keywordByFilter[e.text]}},findKeyword:function(e){var t="",i=e.text;if(n.regexpRegExp.test(i))return t;var r=n.optionsRegExp.exec(i);if(r&&(i=r.input.substr(0,r.index)),"@@"==i.substr(0,2)&&(i=i.substr(2)),e instanceof RedirectFilter)return e.keyword;var s=i.toLowerCase().match(/[^a-z0-9%*][a-z0-9%]{3,}(?=[^a-z0-9%*])/g);if(!s)return t;for(var o=this.filterByKeyword,a=16777215,l=0,u=0,c=s.length;u<c;u++){var f=s[u].substr(1),d=f in o?o[f].length:0;(d<a||d==a&&f.length>l)&&(t=f,a=d,l=f.length)}return t},hasFilter:function(e){return e.text in this.keywordByFilter},getKeywordForFilter:function(e){return e.text in this.keywordByFilter?this.keywordByFilter[e.text]:null},_checkEntryMatch:function(e,t,i,r,n){for(var s=this.filterByKeyword[e],o=0;o<s.length;o++){var a=s[o];if(a.matches(t,i,r,n))return a}return null},matchesAny:function(e,t,i,r){var n=e.toLowerCase().match(/[a-z0-9%]{3,}/g);null===n&&(n=[]),n.push("");for(var s=0,o=n.length;s<o;s++){var a=n[s];if(a in this.filterByKeyword){var l=this._checkEntryMatch(a,e,t,i,r);if(l)return l}}return null}},i.CombinedMatcher=t,t.maxCacheEntries=1e3,t.prototype={blacklist:null,whitelist:null,keys:null,resultCache:null,cacheEntries:0,clear:function(){this.blacklist.clear(),this.whitelist.clear(),this.keys={__proto__:null},this.resultCache={__proto__:null},this.cacheEntries=0},add:function(e){if(e instanceof s)if(e.siteKeys)for(var t=0;t<e.siteKeys.length;t++)this.keys[e.siteKeys[t]]=e.text;else this.whitelist.add(e);else this.blacklist.add(e);this.cacheEntries>0&&(this.resultCache={__proto__:null},this.cacheEntries=0)},remove:function(e){if(e instanceof s)if(e.siteKeys)for(var t=0;t<e.siteKeys.length;t++)delete this.keys[e.siteKeys[t]];else this.whitelist.remove(e);else this.blacklist.remove(e);this.cacheEntries>0&&(this.resultCache={__proto__:null},this.cacheEntries=0)},findKeyword:function(e){return e instanceof s?this.whitelist.findKeyword(e):this.blacklist.findKeyword(e)},hasFilter:function(e){return e instanceof s?this.whitelist.hasFilter(e):this.blacklist.hasFilter(e)},getKeywordForFilter:function(e){return e instanceof s?this.whitelist.getKeywordForFilter(e):this.blacklist.getKeywordForFilter(e)},isSlowFilter:function(e){var t=e instanceof s?this.whitelist:this.blacklist;return t.hasFilter(e)?!t.getKeywordForFilter(e):!t.findKeyword(e)},matchesAnyInternal:function(e,t,i,r){var n=e.toLowerCase().match(/[a-z0-9%]{3,}/g);null===n&&(n=[]),n.push("");for(var s=null,o=0,a=n.length;o<a;o++){var l=n[o];if(l in this.whitelist.filterByKeyword){var u=this.whitelist._checkEntryMatch(l,e,t,i,r);if(u)return u}l in this.blacklist.filterByKeyword&&null===s&&(s=this.blacklist._checkEntryMatch(l,e,t,i,r))}return s},matchesAny:function(e,i,r,n){var s=e+" "+i+" "+r+" "+n;if(s in this.resultCache)return this.resultCache[s];var o=this.matchesAnyInternal(e,i,r,n);return this.cacheEntries>=t.maxCacheEntries&&(this.resultCache={__proto__:null},this.cacheEntries=0),this.resultCache[s]=o,this.cacheEntries++,o},matchesByKey:function(e,t,i){if(t=t.toUpperCase(),t in this.keys){var r=n.knownFilters[this.keys[t]];return r&&r.matches(e,"DOCUMENT",i,!1)?r:null}return null}};i.defaultMatcher=new t;return i}(),require.scopes.filterListener=function(){function e(){u.addListener(function(e,t,i,r){var a=/^(\w+)\.(.*)/.exec(e);a&&"filter"==a[1]?s(a[2],t,i,r):a&&"subscription"==a[1]?n(a[2],t,i,r):o(e,t)}),"nsIStyleSheetService"in Ci?c.init():t=function(){},l.loadFromDisk(),Services.obs.addObserver(m,"browser:purge-session-history",!0),onShutdown.add(function(){Services.obs.removeObserver(m,"browser:purge-session-history")})}function t(){!v&&c.isDirty&&c.apply()}function i(e){if(e instanceof p&&!e.disabled){for(var t=!1,i=0;i<e.subscriptions.length;i++)e.subscriptions[i].disabled||(t=!0);t&&(e instanceof h?f.add(e):e instanceof _&&c.add(e))}}function r(e){if(e instanceof p){if(!e.disabled){for(var t=!1,i=0;i<e.subscriptions.length;i++)e.subscriptions[i].disabled||(t=!0);if(t)return}e instanceof h?f.remove(e):e instanceof _&&c.remove(e)}}function n(e,n,s,o){if(w.setDirty(1),("added"==e||"removed"==e||"disabled"==e||"updated"==e)&&("removed"==e||n.url in l.knownSubscriptions)&&("added"!=e&&"removed"!=e&&"updated"!=e||!n.disabled)){if("added"==e||"removed"==e||"disabled"==e){var a="added"==e||"disabled"==e&&0==s?i:r;n.filters&&n.filters.forEach(a)}else"updated"==e&&(n.oldFilters.forEach(r),n.filters.forEach(i));t()}}function s(e,n,s,o){"hitCount"==e||"lastHit"==e?w.setDirty(.002):w.setDirty(1),"added"!=e&&"removed"!=e&&"disabled"!=e||("added"!=e&&"removed"!=e||!n.disabled)&&("added"==e||"disabled"==e&&0==s?i(n):r(n),t())}function o(e){if("load"==e){g=0,f.clear(),c.clear();for(var r=0;r<l.subscriptions.length;++r){var n=l.subscriptions[r];n.disabled||n.filters.forEach(i)}t()}else"save"==e&&(g=0)}var a={},l=require("filterStorage").FilterStorage,u=require("filterNotifier").FilterNotifier,c=require("elemHide").ElemHide,f=require("matcher").defaultMatcher,d=require("filterClasses"),p=d.ActiveFilter,h=d.RegExpFilter,_=d.ElemHideBase,b=require("prefs").Prefs,v=!1,g=0,w=a.FilterListener={get batchMode(){return v},set batchMode(e){v=e,t()},setDirty:function(e){0==e&&g>0?g=1:g+=e,g>=1&&l.saveToDisk()}},m={observe:function(e,t,i){"browser:purge-session-history"==t&&b.clearStatsOnHistoryPurge&&(l.resetHitCounts(),w.setDirty(0),b.recentReports=[])},QueryInterface:XPCOMUtils.generateQI([Ci.nsISupportsWeakReference,Ci.nsIObserver])};return e(),a}(),require.scopes.synchronizer=function(){var e={},t=require("downloader"),i=t.Downloader,r=t.Downloadable,n=t.MILLIS_IN_SECOND,s=t.MILLIS_IN_MINUTE,o=t.MILLIS_IN_HOUR,a=t.MILLIS_IN_DAY,l=require("filterClasses"),u=l.Filter,c=(l.CommentFilter,require("filterStorage").FilterStorage),f=require("filterNotifier").FilterNotifier,d=require("prefs").Prefs,p=require("subscriptionClasses"),h=p.Subscription,_=p.DownloadableSubscription,b=require("utils").Utils,v=6*s,g=1*o,w=5*a,m=null,y=e.Synchronizer={init:function(){m=new i(this._getDownloadables.bind(this),v,g),onShutdown.add(function(){m.cancel()}),m.onExpirationChange=this._onExpirationChange.bind(this),m.onDownloadStarted=this._onDownloadStarted.bind(this),m.onDownloadSuccess=this._onDownloadSuccess.bind(this),m.onDownloadError=this._onDownloadError.bind(this)},isExecuting:function(e){return m.isDownloading(e)},execute:function(e,t){m.download(this._getDownloadable(e,t))},_getDownloadables:function(){var e=[];if(d.subscriptions_autoupdate){for(var t=0;t<c.subscriptions.length;++t){var i=c.subscriptions[t];i instanceof _&&e.push(this._getDownloadable(i,!1))}return e}},_getDownloadable:function(e,t){var i=new r(e.url);return e.lastDownload!=e.lastSuccess&&(i.lastError=e.lastDownload*n),i.lastCheck=e.lastCheck*n,i.lastVersion=e.version,i.softExpiration=e.softExpiration*n,i.hardExpiration=e.expires*n,i.manual=t,i},_onExpirationChange:function(e){var t=h.fromURL(e.url);t.lastCheck=Math.round(e.lastCheck/n),t.softExpiration=Math.round(e.softExpiration/n),t.expires=Math.round(e.hardExpiration/n)},_onDownloadStarted:function(e){var t=h.fromURL(e.url);f.triggerListeners("subscription.downloadStatus",t)},_onDownloadSuccess:function(e,t,i,r){var s=t.split(/[\r\n]+/),l=/\[Adblock(?:\s*Plus\s*([\d\.]+)?)?\]/i.exec(s[0]);if(!l)return i("synchronize_invalid_data");for(var f=l[1],d=[],p={redirect:null,homepage:null,title:null,version:null,expires:null},_=0;_<s.length;_++){var l=/^\s*!\s*(\w+)\s*:\s*(.*)/.exec(s[_]);if(l){var v=l[1].toLowerCase(),g=l[2];if(v in p)p[v]=g,d.push(_);else if("checksum"==v){s.splice(_--,1);var y=b.generateChecksum(s);if(y&&y!=g.replace(/=+$/,""))return i("synchronize_checksum_mismatch")}}}if(p.redirect)return r(p.redirect);var S=h.fromURL(e.redirectURL||e.url);if(e.redirectURL&&e.redirectURL!=e.url){var x=h.fromURL(e.url);S.title=x.title,S.disabled=x.disabled,S.lastCheck=x.lastCheck;var E=x.url in c.knownSubscriptions;E&&c.removeSubscription(x),delete h.knownSubscriptions[x.url],E&&c.addSubscription(S)}S.lastSuccess=S.lastDownload=Math.round(Date.now()/n),S.downloadStatus="synchronize_ok",S.errors=0;for(var _=d.length-1;_>=0;_--)s.splice(d[_],1);if(p.homepage){var C=b.makeURI(p.homepage);!C||"http"!=C.scheme&&"https"!=C.scheme||(S.homepage=C.spec)}p.title?(S.title=p.title,S.fixedTitle=!0):S.fixedTitle=!1,S.version=p.version?parseInt(p.version,10):0;var k=w;if(p.expires){var l=/^(\d+)\s*(h)?/.exec(p.expires);if(l){var F=parseInt(l[1],10);k=l[2]?F*o:F*a}}var I=m.processExpirationInterval(k),O=I[0],D=I[1];if(S.softExpiration=Math.round(O/n),S.expires=Math.round(D/n),delete S.requiredVersion,delete S.upgradeRequired,f){var L=require("info").addonVersion;S.requiredVersion=f,Services.vc.compare(f,L)>0&&(S.upgradeRequired=!0)}s.shift();for(var R=[],T=0;T<s.length;++T){var N=s[T];N=u.normalize(N),N&&R.push(u.fromText(N))}c.updateSubscriptionFilters(S,R)},_onDownloadError:function(e,t,i,r,s,o){var a=h.fromURL(e.url);if(a.lastDownload=Math.round(Date.now()/n),a.downloadStatus=i,!e.manual&&(a.errors++,o&&a.errors>=d.subscriptions_fallbackerrors&&/^https?:\/\//i.test(a.url))){a.errors=0;var l=d.subscriptions_fallbackurl,u=require("info").addonVersion;l=l.replace(/%VERSION%/g,encodeURIComponent(u)),l=l.replace(/%SUBSCRIPTION%/g,encodeURIComponent(a.url)),l=l.replace(/%URL%/g,encodeURIComponent(t)),l=l.replace(/%ERROR%/g,encodeURIComponent(i)),l=l.replace(/%CHANNELSTATUS%/g,encodeURIComponent(r)),l=l.replace(/%RESPONSESTATUS%/g,encodeURIComponent(s));var f=new XMLHttpRequest;f.mozBackgroundRequest=!0,f.open("GET",l),f.overrideMimeType("text/plain"),f.channel.loadFlags=f.channel.loadFlags|f.channel.INHIBIT_CACHING|f.channel.VALIDATE_ALWAYS,f.addEventListener("load",function(e){if(!onShutdown.done&&a.url in c.knownSubscriptions){var t=/^(\d+)(?:\s+(\S+))?$/.exec(f.responseText);if(t&&"301"==t[1]&&t[2]&&/^https?:\/\//i.test(t[2]))o(t[2]);else if(t&&"410"==t[1]){var i="[Adblock]\n"+a.filters.map(function(e){return e.text}).join("\n");o("data:text/plain,"+encodeURIComponent(i))}}},!1),f.send(null)}}};return y.init(),e}(),require.scopes.notification=function(){function e(e){var t={information:0,critical:1};return e.severity in t?t[e.severity]:t.information}function t(){n.notificationdata=JSON.parse(JSON.stringify(n.notificationdata))}function i(e,t){if(t in e)return e[t];var i=t.substring(0,t.indexOf("-"));if(i&&i in e)return e[i];var r="en-US";return e[r]}var r={},n=require("prefs").Prefs,s=require("downloader"),o=s.Downloader,a=s.Downloadable,l=s.MILLIS_IN_MINUTE,u=s.MILLIS_IN_HOUR,c=(s.MILLIS_IN_DAY,require("utils").Utils),f=12*l,d=1*u,p=5*u;window.updateAllSubscriptions=function(){for(var e=require("filterStorage").FilterStorage,t=0;t<e.subscriptions.length;t++){var i=e.subscriptions[t];Synchronizer.execute(i,!0,!0)}};var h=null,_=r.Notification={init:function(){h=new o(this._getDownloadables.bind(this),f,d),onShutdown.add(function(){h.cancel()}),h.onExpirationChange=this._onExpirationChange.bind(this),h.onDownloadSuccess=this._onDownloadSuccess.bind(this),h.onDownloadError=this._onDownloadError.bind(this)},_getDownloadables:function(){var e=[],t=new a(n.notificationurl);return"number"==typeof n.notificationdata.lastError&&(t.lastError=n.notificationdata.lastError),"number"==typeof n.notificationdata.lastCheck&&(t.lastCheck=n.notificationdata.lastCheck),"object"==typeof n.notificationdata.data&&"version"in n.notificationdata.data&&(t.lastVersion=n.notificationdata.data.version),"number"==typeof n.notificationdata.softExpiration&&(t.softExpiration=n.notificationdata.softExpiration),"number"==typeof n.notificationdata.hardExpiration&&(t.hardExpiration=n.notificationdata.hardExpiration),e.push(t),e},_onExpirationChange:function(e){n.notificationdata.lastCheck=e.lastCheck,n.notificationdata.softExpiration=e.softExpiration,n.notificationdata.hardExpiration=e.hardExpiration,t()},_onDownloadSuccess:function(e,i,r,s){function o(e){if("false"!==localStorage.notificationRules&&chrome&&chrome.notifications){""===e.icon&&(e.icon=chrome.runtime.getURL("/icons/new-128.png"));var t=[{title:"马上去看看",iconUrl:chrome.runtime.getURL("/icons/car.png")},{title:"选项设置",iconUrl:chrome.runtime.getURL("/icons/setting.png")}],i={type:"basic",title:e.title,message:e.message,iconUrl:e.icon,buttons:t};chrome.notifications.create("push"+e.time,i,function(){})}}function a(e){chrome.notifications&&(chrome.notifications.onButtonClicked.addListener(function(t,i){if(t=="push"+e.time)switch(i){case 0:chrome.tabs.create({url:e.link});break;case 1:chrome.tabs.create({url:"options.html"})}}),chrome.notifications.onClicked.addListener(function(t){t=="push"+e.time&&chrome.tabs.create({url:e.link})}))}try{n.notificationdata.data=JSON.parse(i)}catch(l){return Cu.reportError(l),void r("synchronize_invalid_data")}n.notificationdata.lastError=0,n.notificationdata.downloadStatus="synchronize_ok";var u=h.processExpirationInterval(p);n.notificationdata.softExpiration=u[0],n.notificationdata.hardExpiration=u[1],t();var c=n.notificationdata,f=c.data.notifications,d=c.hasNontifacationTime;void 0==d&&(d=0);for(var _=0,b=0;b<f.length;b++)f[b].time>d&&(!function(e,i){setTimeout(function(){o(e),a(e),n.notificationdata.hasNontifacationTime=e.time,t()},20*i*60*1e3)}(f[b],_),_+=1);for(var v=c.data.subscriptions||[],b=0;b<FilterStorage.subscriptions.length;b++)for(var g=FilterStorage.subscriptions[b],w=0;w<v.length;w++)g.url==v[w].url&&v[w].version>g.version&&Synchronizer.execute(g,!0,!0)},_onDownloadError:function(e,i,r,s,o,a){n.notificationdata.lastError=Date.now(),n.notificationdata.downloadStatus=r,t()},getNextToShow:function(){function i(e,t,i,r){var n=t+"MinVersion",s=t+"MaxVersion";return!(t in e&&e[t]!=i||n in e&&Services.vc.compare(r,e[n])<0||s in e&&Services.vc.compare(r,e[s])>0)}if("object"!=typeof n.notificationdata.data||!(n.notificationdata.data.notifications instanceof Array))return null;n.notificationdata.shown instanceof Array||(n.notificationdata.shown=[],t());for(var r=require("info"),s=r.addonName,o=r.addonVersion,a=r.application,l=r.applicationVersion,u=r.platform,c=r.platformVersion,f=n.notificationdata.data.notifications,d=null,p=0;p<f.length;++p){var h=f[p];if("undefined"!=typeof h.severity&&"information"!==h.severity||n.notificationdata.shown.indexOf(h.id)===-1){if(h.targets instanceof Array){for(var _=!1,b=0;b<h.targets.length;++b){var v=h.targets[b];if(i(v,"extension",s,o)&&i(v,"application",a,l)&&i(v,"platform",u,c)){_=!0;break}}if(!_)continue}(!d||e(h)>e(d))&&(d=h)}}return d&&"id"in d&&(n.notificationdata.shown.push(d.id),t()),d},getLocalizedTexts:function(e,t){t=t||c.appLocale;for(var r=["title","message"],n=[],s=0;s<r.length;++s){var o=r[s];o in e&&(n[o]=i(e[o],t))}return n}};return _.init(),r}(),require.scopes.stats=function(){var e={},t=require("prefs").Prefs,i=require("filterClasses").BlockingFilter,r=require("filterNotifier").FilterNotifier;e.getStats=function(e,i){if(i){var r=getFrameData(i,0);return r&&e in r?r[e]:0}return e in t.stats_total?t.stats_total[e]:0};return r.addListener(function(e,r,n,s,o){if("filter.hitCount"==e&&(r instanceof i||r instanceof RedirectFilter)){"blocked"in t.stats_total?t.stats_total.blocked++:t.stats_total.blocked=1,t.stats_total=t.stats_total;var a=getFrameData(o,0);a&&("blocked"in a?a.blocked++:a.blocked=1)}}),e}();