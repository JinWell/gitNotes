!function(){"use strict";function e(e,t,i){var n=[i],r=function(i){var n=e.get("$q"),r=e.get("userService"),s=n.defer();Utilities.isUndefinedOrNull(i)&&(i={}),i.pii=[];var a=Utilities.getManifest();a&&(i.appVersion=a.version);var d=BrowserHandler.i18n.getUILanguage();return Utilities.isNotUndefinedOrNull(d)&&(i.language=d),i["AppInfo.Name"]=t.APPINFO_NAME,r.getUserType().then(function(e){var n=AWTLogManager.getSemanticContext();return e===t.USER_TYPE.NONE?(n.setUserId("","",""),void s.resolve(i)):void r.getUserInfo(e,function(e){return Utilities.isUndefinedOrNull(e)?(n.setUserId("","",""),void s.resolve(i)):(Utilities.isNotUndefinedOrNull(e.cid)&&(i.cid=e.cid,n.setUserId(e.cid),i["UserInfo.IdType"]=t.IDTYPE.MSACID),Utilities.isNotUndefinedOrNull(e.features)&&(i.experimentFeatures=e.features),Utilities.isNotUndefinedOrNull(e.puid)&&(i.pii.push({type:t.TELEMETRY.PII_TYPE.IDENTITY,name:"puid",value:e.puid}),n.setUserId(e.puid),i["UserInfo.IdType"]=t.IDTYPE.ORGIDPUID),Utilities.isNotUndefinedOrNull(e.tid)&&(i["UserInfo.OMSTenantId"]=e.tid),void s.resolve(i))})}),s.promise},s=function(){var t=e.get("$q"),i=e.get("storage"),n=t.defer();return i.get("telemetry_enabled").then(function(e){n.resolve(!(!Utilities.isUndefinedOrNull(e)&&!Utilities.isUndefinedOrNull(e.telemetry_enabled)&&e.telemetry_enabled!==!0))}),n.promise},a=function(t){var i=e.get("storage");i.set({telemetry_enabled:t})},d={getEnabledSetting:function(){return s()},setEnabledSetting:function(e){if(!Utilities.isBackgroundContext())return void BrowserHandler.runtime.sendMessage({activity:t.ACTIVITY.TELEMETRY.NAME,command:t.TELEMETRY.COMMAND.SET_DISABLED,enabled:e});a(e);for(var i=0;i<n.length;++i)n[i].setEnabledSetting(e)},trackEvent:function(e,i,s){if(!angular.isUndefined(e)&&angular.isString(e))return Utilities.isBackgroundContext()?void r(i).then(function(t){for(var i=0;i<n.length;++i){var r=angular.extend({},t);n[i].trackEvent(e,r,s)}}):void BrowserHandler.runtime.sendMessage({activity:t.ACTIVITY.TELEMETRY.NAME,command:t.TELEMETRY.COMMAND.TRACK_EVENT,eventName:e,properties:i,measurements:s})},trackTrace:function(e,i){if(!angular.isUndefined(e)&&angular.isString(e))return Utilities.isBackgroundContext()?void r(i).then(function(t){for(var i=0;i<n.length;++i){var r=angular.extend({},t);n[i].trackTrace(e,r)}}):void BrowserHandler.runtime.sendMessage({activity:t.ACTIVITY.TELEMETRY.NAME,command:t.TELEMETRY.COMMAND.TRACK_TRACE,message:e,properties:i})}};return d}angular.module("app.diagnostics",[]).service("telemetry",["$injector","constants","ariaTelemetry",e])}();