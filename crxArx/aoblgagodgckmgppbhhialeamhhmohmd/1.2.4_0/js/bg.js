dojo.global.site="http://www.wordmemo.com";function getTabUrl(){var a=localStorage.version;return a&&0!=a?{url:site,width:1024,height:768}:{url:site+"/portable",width:850,height:700}}dojo.global.serviceUrl=site+"/studyInfo/getMyWordsCount_ajax";dojo.global.windowId=0;
function displayer(){var a=dojo.global.reviewCount;0<dojo.global.shortCount?(chrome.browserAction.setBadgeBackgroundColor({color:[255,0,0,255]}),chrome.browserAction.setBadgeText({text:"Now!"})):(0<=a?chrome.browserAction.setBadgeBackgroundColor({color:[0,200,0,100]}):chrome.browserAction.setBadgeBackgroundColor({color:[255,0,0,255]}),chrome.browserAction.setBadgeText({text:String(a)}))}
function monitor(){dojo.xhrPost({url:serviceUrl,handleAs:"json",timeout:15E3,load:function(a){try{dojo.isObject(a)?dojo.global.reviewCount=a.WordCount:0==a&&(dojo.global.reviewCount="null"),displayer()}catch(b){}},error:function(a){dojo.global.reviewCount="err";displayer();window.setTimeout(function(){monitor()},6E4)}})}function getClickHandler(a,b){chrome.tabs.create({url:"info.html#"+a.selectionText,selected:!0})}
chrome.contextMenus.create({title:"\u5355\u8bcd\u91ca\u4e49",type:"normal",contexts:["selection"],onclick:getClickHandler});
function lookup(a){var b=localStorage.query;b&&0!=b||("undefined"!=typeof webkitNotifications.createHTMLNotification?(a=webkitNotifications.createHTMLNotification("note.html#"+a),a.ondisplay=function(){this.status="display"},a.onclose=function(){this.status="close"},a.show(),dojo.subscribe("closeNoteEvent",a,function(){(this.status="display")&&this.cancel()})):chrome.tabs.create({url:"info.html#"+a,selected:!0}))}
chrome.extension.onConnect.addListener(function(a){a.onMessage.addListener(function(a){"onLoadFv"==a.message?monitor():"onResume"==a.message?(dojo.global.shortCount=a.values,displayer()):"lookupEvent"==a.message?lookup(a.values):"closeNoteEvent"==a.message&&dojo.publish("closeNoteEvent")})});
dojo.ready(function(){chrome.browserAction.onClicked.addListener(function(a){chrome.windows.get(dojo.global.windowId,function(a){a?chrome.windows.update(dojo.global.windowId,{focused:!0}):(a=getTabUrl(),chrome.windows.create({url:a.url,type:"popup",width:a.width,height:a.height},function(a){dojo.global.windowId=a.id}))})});monitor();window.setInterval(function(){monitor()},36E5)});