!function(e){function t(t){for(var n,a,s=t[0],c=t[1],u=t[2],f=0,p=[];f<s.length;f++)a=s[f],o[a]&&p.push(o[a][0]),o[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(l&&l(t);p.length;)p.shift()();return i.push.apply(i,u||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,s=1;s<r.length;s++){var c=r[s];0!==o[c]&&(n=!1)}n&&(i.splice(t--,1),e=a(a.s=r[0]))}return e}var n={},o={1:0},i=[];function a(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;i.push([199,0]),r()}({199:function(e,t,r){"use strict";r.r(t);var n,o=r(7),i=r.n(o),a=r(0),s=r(1),c=r(11),u=r.n(c),l=r(45),f=Object(l.a)({lifetime:1e4}),p=document.createElement("textarea");document.body.appendChild(p),document.addEventListener("copy",function(e){e.preventDefault();var t=n,r=t.type,o=t.data;e.clipboardData.setData(r||"text/plain",o)},!1);var d=r(21),h=r.n(d),m=[];function v(e){m.push(e)}var g={isApplied:!0,autoUpdate:!0,lastUpdate:0,lastModified:0,showBadge:"unique",exportValues:!0,closeAfterInstall:!1,trackLocalFile:!1,autoReload:!1,features:null,blacklist:null,syncScriptStatus:!0,sync:null,customCSS:null,importSettings:!0,notifyUpdates:!1,version:null,defaultInjectInto:"page",filters:{sort:"exec"},editor:{lineWrapping:!1,indentUnit:2},scriptTemplate:"// ==UserScript==\n// @name New Script\n// @namespace Violentmonkey Scripts\n// @match {{url}}\n// @grant none\n// ==/UserScript==\n"},b={},y=Object(a.j)(),j=Object(a.c)(function(){y.fire(b),b={}},100),O={},w=!1,k=browser.storage.local.get("options").then(function(e){var t=e.options;if(t&&"object"==typeof t&&(O=t),!Object(s.a)(O,"version")){0;try{localStorage.length&&Object.keys(g).forEach(function(e){var t=localStorage.getItem(e);if(t)try{t=JSON.parse(t)}catch(e){t=null}t&&x(e,t)})}catch(e){}x("version",1)}}).then(function(){w=!0});function S(e,t){var r=Object(a.n)(e),n=r[0],o=O[n];return null==o&&(o=g[n]),null==o&&(o=t),r.length>1?Object(s.a)(o,r.slice(1),t):o}function x(e,t){if(w){var r=Object(a.n)(e),n=(r.join("."),t),o=r[0];o in g&&(r.length>1&&(n=Object(s.d)(S(o),r.slice(1),t)),O[o]=n,browser.storage.local.set({options:O}),function(e,t){Object(s.d)(b,e,t),j()}(r,t))}else k.then(function(){x(e,t)})}v(k);var P=y.hook,M="==UserScript==",E="==/UserScript==";var T={default:function(){return[]},transform:function(e,t){return e.push(t),e}},U={default:function(){return null},transform:function(e,t){return null==e?t:e}},_={include:T,exclude:T,match:T,excludeMatch:T,require:T,resource:{default:function(){return{}},transform:function(e,t){var r=t.match(/^(\w\S*)\s+(.*)/);return r&&(e[r[1]]=r[2]),e}},grant:T,noframes:{default:function(){return!1},transform:function(){return!0}}};function $(e){var t=Object.keys(_).reduce(function(e,t){return Object.assign(e,{[t]:_[t].default()})},{}),r=-1;return e.replace(/(?:^|\n)\s*\/\/\s*([@=]\S+)(.*)/g,function(e,n,o){if(r<0&&n===M?r=1:r>0&&n===E&&(r=0),1===r&&"@"===n[0]){var a=n.slice(1).split(":"),s=i()(a,2),c=s[0],u=s[1],l=c.replace(/[-_](\w)/g,function(e,t){return t.toUpperCase()}),f=u?`${l}:${u.toLowerCase()}`:l,p=o.trim(),d=_[f]||U,h=t[f];void 0===h&&(h=d.default()),t[f]=d.transform(h,p)}}),t.resources=t.resource,delete t.resource,!t.homepageURL&&t.homepage&&(t.homepageURL=t.homepage),t}function I(e){var t=h()({url:"*://*/*"},e),r=S("scriptTemplate").replace(/{{(\w+)}}/g,function(e,r){var n=t[r];return null==n?e:n});return{script:{custom:{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},config:{enabled:1,shouldUpdate:1},meta:$(r)},code:r}}function R(e){var t=e.meta.namespace||"",r=e.meta.name||"",n=`${escape(t)}:${escape(r)}:`;return t||r||(n+=e.props.id||""),n}var C=r(23);C.c(!0);var D=/(.*?):\/\/([^\/]*)\/(.*)/,A=[];P(function(e){"blacklist"in e&&G(e.blacklist||"")});var z=/^https?$/i;function q(e,t){return t.some(function(t){var r=`re:${t}`,n=f.get(r);return n?f.hit(r,6e4):(n=B(t),f.put(r,n,6e4)),n.test(e)})}function L(e,t){return t.some(function(t){var r=`match:${t}`,n=f.get(r);return n?f.hit(r,6e4):(n=F(t),f.put(r,n,6e4)),n.test(e)})}function N(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(e,t){return t?e.concat(t):e},[])}function V(e){return`^${e.replace(/([.?+[\]{}()|^$])/g,"\\$1").replace(/\*/g,".*?")}$`}function B(e){if(e.length>1&&"/"===e[0]&&"/"===e[e.length-1])return new RegExp(e.slice(1,-1));var t=V(e),r=new RegExp(t),n=[function(e){return r.test(e)}];if(C.d()&&e.includes(".tld/")){var o=t.replace("\\.tld/","((?:\\.\\w+)+)/");n.push(function(e){var t=e.match(o);if(t){var r=t[1].slice(1);if(C.b(r)===r)return!0}return!1})}return{test:function(e){return n.some(function(t){return t(e)})}}}function F(e){var t;if("<all_urls>"===e)t=function(){return!0};else{var r=e.match(D);if(r){var n=function(e){var t=new RegExp(V(e));return function(r){if("*"===e)return 1;if(e===r)return 1;if(/^\*\.[^*]*$/.test(e)){if(e.slice(2)===r)return 1;if(t.test(r))return 1}return 0}}(r[2]),o=function(e){var t=e.indexOf("#"),r=e.indexOf("?"),n=V(e);r>t&&(r=-1),r<0&&t<0?n=`${n.slice(0,-1)}(?:[?#]|$)`:t<0&&(n=`${n.slice(0,-1)}(?:#|$)`);var o=new RegExp(n);return function(e){return o.test(e)}}(r[3]);t=function(e){var t,i,a=e.match(D);return!!r&&!!a&&(t=r[1],i=a[1],t===i?1:"*"===t&&z.test(i)?1:0)&&n(a[2])&&o(a[3])}}else t=function(){return!1}}return{test:t}}function H(e,t){if(t.startsWith(e))return t.slice(e.length).trim()}function G(e){var t=null==e?S("blacklist"):e;A=(Array.isArray(t)?t:(t||"").split("\n")).map(function(e){var t=e.trim();if(!t||t.startsWith("#"))return null;var r=H("@include ",t);if(r)return{test:B(r).test,reject:!1};var n=H("@match ",t);if(n)return{test:F(n).test,reject:!1};var o=H("@exclude ",t);return o?{test:B(o).test,reject:!0}:t.indexOf("/")<0?{test:F(`*://${t}/*`).test,reject:!0}:{test:F(t).test,reject:!0}}).filter(Boolean)}var J=function(){return new Promise(function(e,t){var r;console.info("Upgrade database..."),(r=indexedDB.open("Violentmonkey",1)).onsuccess=function(){try{n=r.result,o=n.transaction(["scripts","require","cache","values"]),i={},a=3,s=function(){(a-=1)||e(browser.storage.local.set(i))},function(e,r){var n=e.objectStore("scripts"),o=[],i=n.openCursor();i.onsuccess=function(e){var t,n=e.target.result;if(n){var i=n.value;o.push({script:{meta:$((t=i).code),custom:Object.assign({origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},t.custom),props:{id:t.id,uri:t.uri,position:t.position},config:{enabled:t.enabled,shouldUpdate:t.update}},code:t.code}),n.continue()}else r(o)},i.onerror=t}(o,function(e){var r={};e.forEach(function(e){var t=e.script,n=e.code;i[`scr:${t.props.id}`]=t,i[`code:${t.props.id}`]=n,r[t.props.uri]=t.props.id}),function(e,r,n){var o=e.objectStore("values"),i=[],a=o.openCursor();a.onsuccess=function(e){var t=e.target.result;if(t){var o=t.value,a=o.uri,s=o.values,c=n[a];c&&i.push({id:c,values:s}),t.continue()}else r(i)},a.onerror=t}(o,function(e){e.forEach(function(e){var t=e.id,r=e.values;i[`val:${t}`]=r}),s()},r)}),function(e,r){var n=e.objectStore("cache"),o=[],i=n.openCursor();i.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value,i=n.uri,a=n.data;o.push({uri:i,data:a}),t.continue()}else r(o)},i.onerror=t}(o,function(e){e.forEach(function(e){var t=e.uri,r=e.data;i[`cac:${t}`]=r}),s()}),function(e,r){var n=e.objectStore("require"),o=[],i=n.openCursor();i.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value,i=n.uri,a=n.code;o.push({uri:i,code:a}),t.continue()}else r(o)},i.onerror=t}(o,function(e){e.forEach(function(e){var t=e.uri,r=e.code;i[`req:${t}`]=r}),s()})}catch(e){t(e)}var n,o,i,a,s},r.onerror=t,r.onupgradeneeded=function(){t()}}).catch(function(){})};function W(e){browser.notifications.create(e.id||"ViolentMonkey",{type:"basic",iconUrl:a.d,title:`${e.title} - ${Object(a.i)("extName")}`,message:e.body,isClickable:e.isClickable})}function K(){var e;return(e=browser.runtime).sendMessage.apply(e,arguments).catch(a.m)}var Z=r(80),X=r.n(Z),Q=r(81),Y=r.n(Q),ee=new(function(){function e(t){X()(this,e),this.events={},this.allowed=t}return Y()(e,[{key:"checkType",value:function(e){if(this.allowed&&!this.allowed.includes(e))throw new Error(`Unknown event type: ${e}`)}},{key:"on",value:function(e,t){var r=this;this.checkType(e);var n=this.events,o=n[e];return o||(o=[],n[e]=o),function(){return r.off(e,t)}}},{key:"off",value:function(e,t){this.checkType(e);var r=this.events[e];if(r){var n=r.indexOf(t);n>=0&&r.splice(n,1)}}},{key:"emit",value:function(e,t){this.checkType(e);var r=this.events[e];if(r){var n={type:e,data:t,defaultPrevented:!1,preventDefault(){n.defaultPrevented=!0}};r.some(function(e){return e(n),n.defaultPrevented})}}}]),e}())(["scriptEdit","scriptChanged"]);function te(e){var t={};return function(r){var n=t[r];if(!n){for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];n=e.call.apply(e,[this,r].concat(i)).catch(function(e){console.error(`Error fetching: ${r}`,e)}).then(function(){delete t[r]}),t[r]=n}return n}}var re,ne={},oe={base:{prefix:"",getKey(e){return`${this.prefix}${e}`},getOne(e){var t=this.getKey(e);return browser.storage.local.get(t).then(function(e){return e[t]})},getMulti(e,t){var r=this;return browser.storage.local.get(e.map(function(e){return r.getKey(e)})).then(function(n){var o={};return e.forEach(function(e){o[e]=n[r.getKey(e)]||t}),o})},set(e,t){return e?browser.storage.local.set({[this.getKey(e)]:t}):Promise.resolve()},remove(e){return e?browser.storage.local.remove(this.getKey(e)):Promise.resolve()},removeMulti(e){var t=this;return browser.storage.local.remove(e.map(function(e){return t.getKey(e)}))}}};function ie(e){return+e||0}function ae(){var e=[];ne.scripts.forEach(function(t,r){var n=r+1;Object(s.a)(t,"props.position")!==n&&(Object(s.d)(t,"props.position",n),e.push(t))}),ne.storeInfo.position=ne.scripts.length;var t=e.length;return t?oe.script.dump(e).then(function(){return x("lastModified",Date.now()),t}):Promise.resolve()}function se(){return ne.scripts.sort(function(e,t){var r=[e,t].map(function(e){return ie(Object(s.a)(e,"props.position"))}),n=i()(r,2);return n[0]-n[1]}),ae().then(function(e){return K({cmd:"ScriptsUpdated"}),e})}function ce(e){var t;if(e.id)t=ne.scriptMap[e.id];else{var r=e.uri||R({meta:e.meta,id:"@@should-have-name"});t=ne.scripts.find(function(e){return r===Object(s.a)(e,"props.uri")})}return Promise.resolve(t)}function ue(){return Promise.resolve(ne.scripts).then(function(e){return e.filter(function(e){return!e.config.removed})})}function le(e){return oe.code.getOne(e)}function fe(e){return oe.value.getMulti(e)}function pe(e){return oe.value.dump(e).then(function(){return e})}function de(e){var t=function(e){for(var t=0;t<A.length;t+=1){var r=A[t],n=r.test,o=r.reject;if(n(e))return o}}(e)?[]:ne.scripts.filter(function(t){return!t.config.removed&&function(e,t){var r=t.custom,n=t.meta,o=N(r.origMatch&&n.match,r.match),i=N(r.origInclude&&n.include,r.include),a=N(r.origExclude&&n.exclude,r.exclude),s=N(r.origExcludeMatch&&n.excludeMatch,r.excludeMatch),c=!o.length&&!i.length;return c=(c=(c=(c=c||L(e,o))||q(e,i))&&!L(e,s))&&!q(e,a)}(e,t)}),r={},n={};t.forEach(function(e){if(e.config.enabled){e.custom.pathMap||we(e);var t=e.custom.pathMap;e.meta.require.forEach(function(e){r[t[e]||e]=1}),Object.values(e.meta.resources).forEach(function(e){n[t[e]||e]=1})}});var o=t.filter(function(e){return e.config.enabled}),a={GM_getValue:1,GM_setValue:1,GM_listValues:1,GM_deleteValue:1},c=o.filter(function(e){var t=Object(s.a)(e,"meta.grant");return t&&t.some(function(e){return a[e]})});return Promise.all([oe.require.getMulti(Object.keys(r)),oe.cache.getMulti(Object.keys(n)),oe.value.getMulti(c.map(function(e){return e.props.id}),{}),oe.code.getMulti(o.map(function(e){return e.props.id}))]).then(function(e){var r=i()(e,4),n=r[0],o=r[1],a=r[2],s=r[3];return{scripts:t,require:n,cache:o,values:a,code:s}})}function he(){var e={},t=ne.scripts;return t.forEach(function(t){var r=Object(s.a)(t,"meta.icon");if(Object(a.k)(r)){var n=(Object(s.a)(t,"custom.pathMap")||{})[r]||r;e[n]=1}}),oe.cache.getMulti(Object.keys(e)).then(function(e){return{scripts:t,cache:e}})}function me(){var e=ne.scripts.filter(function(e){return e.config.removed});if(e.length){ne.scripts=ne.scripts.filter(function(e){return!e.config.removed});var t=e.map(function(e){return e.props.id});oe.script.removeMulti(t),oe.code.removeMulti(t),oe.value.removeMulti(t)}return Promise.resolve(e.length)}function ve(e){var t=ne.scripts.findIndex(function(t){return e===Object(s.a)(t,"props.id")});return t>=0&&(ne.scripts.splice(t,1),oe.script.remove(e),oe.code.remove(e),oe.value.remove(e)),K({cmd:"RemoveScript",data:e}),Promise.resolve()}function ge(e,t){var r=e.config||{};r.enabled=ie(r.enabled),r.shouldUpdate=ie(r.shouldUpdate);var n,o=e.props||{};if(o.id?n=ne.scriptMap[o.id]:(ne.storeInfo.id+=1,o.id=ne.storeInfo.id),o.uri=R(e),o.uuid=o.uuid||`${(o.id+280880802).toString(16).slice(-8)}-${Object(a.g)()}-${Object(a.g)()}-${Object(a.g)()}-${Object(a.g)()}${Object(a.g)()}${Object(a.g)()}`,ne.scripts.some(function(e){var t=e.props||{};return o.id!==t.id&&o.uri===t.uri}))throw Object(a.i)("msgNamespaceConflict");if(n){e.config=Object.assign({},n.config,r),e.props=Object.assign({},n.props,o);var i=ne.scripts.indexOf(n);ne.scripts[i]=e}else o.position?ne.storeInfo.position<o.position&&(ne.storeInfo.position=o.position):(ne.storeInfo.position+=1,o.position=ne.storeInfo.position),e.config=r,e.props=o,ne.scripts.push(e);return Promise.all([oe.script.dump(e),oe.code.set(o.id,t)])}function be(e,t){var r=ne.scriptMap[e];return r?(r.props=Object.assign({},r.props,t.props),r.config=Object.assign({},r.config,t.config),oe.script.dump(r)):Promise.reject()}oe.script=Object.assign({},oe.base,{prefix:"scr:",dump:(re=function(e){var t=this,r={};return e.forEach(function(e){r[t.getKey(e.props.id)]=e,ne.scriptMap[e.props.id]=e}),browser.storage.local.set(r).then(function(){return e})},function(e){var t=Array.isArray(e)?e:[e];return(t=t.filter(Boolean)).length?re.call(this,t):Promise.resolve()})}),oe.code=Object.assign({},oe.base,{prefix:"code:"}),oe.value=Object.assign({},oe.base,{prefix:"val:",dump(e){var t=this,r={};return Object.keys(e).forEach(function(n){var o=e[n];r[t.getKey(n)]=o}),browser.storage.local.set(r)}}),oe.require=Object.assign({},oe.base,{prefix:"req:",fetch:te(function(e){var t=this;return Object(a.o)(e).then(function(r){var n=r.data;return t.set(e,n)})})}),oe.cache=Object.assign({},oe.base,{prefix:"cac:",fetch:te(function(e,t){var r=this;return Object(a.o)(e,{responseType:"arraybuffer"}).then(function(n){var o=n.data,i=(n.xhr.getResponseHeader("content-type")||"").split(";")[0],s={contentType:i,buffer:o,blob:function(e){return new Blob([o],Object.assign({type:i},e))},string:function(){return Object(a.a)(o)},base64:function(){return window.btoa(s.string())}};return(t?Promise.resolve(t(s)):Promise.resolve()).then(function(){return r.set(e,`${i},${s.base64()}`)})})})}),v(browser.storage.local.get("version").then(function(e){var t=e.version,r=browser.runtime.getManifest(),n=r.version;return(t?Promise.resolve():J()).then(function(){if(n!==t)return browser.storage.local.set({version:n})})}).then(function(){return browser.storage.local.get()}).then(function(e){var t=[],r={id:0,position:0};return Object.keys(e).forEach(function(n){var o=e[n];n.startsWith("scr:")&&(t.push(o),r.id=Math.max(r.id,ie(Object(s.a)(o,"props.id"))),r.position=Math.max(r.position,ie(Object(s.a)(o,"props.position"))))}),t.forEach(function(e){e.custom=h()({},{origInclude:!0,origExclude:!0,origMatch:!0,origExcludeMatch:!0},e.custom)}),Object.assign(ne,{scripts:t,storeInfo:r,scriptMap:t.reduce(function(e,t){return e[t.props.id]=t,e},{})}),se()}));var ye="UpdateScript",je="AddScript";function Oe(e){var t=e.id,r=e.code,n=e.message,o=e.isNew,i=e.config,c=e.custom,u=e.props,l=e.update,f=$(r);if(!f.name)return Promise.reject(Object(a.i)("msgInvalidScript"));var p={cmd:ye,data:{update:{message:null==n?Object(a.i)("msgUpdated"):n||""}}};return ce({id:t,meta:f}).then(function(t){var n;if(t){if(o)throw Object(a.i)("msgNamespaceConflict");n=Object.assign({},t)}else{var l=I();n=l.script,p.cmd=je,p.data.isNew=!0,p.data.update.message=Object(a.i)("msgInstalled")}n.config=Object.assign({},n.config,i,{removed:0}),n.custom=Object.assign({},n.custom,c),n.props=Object.assign({},n.props,{lastModified:Date.now(),lastUpdated:Date.now()},u),n.meta=f,f.homepageURL||n.custom.homepageURL||!Object(a.k)(e.from)||(n.custom.homepageURL=e.from),Object(a.k)(e.url)&&(n.custom.lastInstallURL=e.url);var d=+e.position;return d&&Object(s.d)(n,"props.position",d),we(n,e.url),ge(n,r).then(function(){return n})}).then(function(t){return function(e,t){var r=e.meta,n=e.custom.pathMap;if(r.require.forEach(function(e){var r=n[e]||e,o=Object(s.a)(t,["require",r]);o?oe.require.set(r,o):oe.require.fetch(r)}),Object.values(r.resources).forEach(function(e){var r=n[e]||e,o=Object(s.a)(t,["resources",r]);o?oe.cache.set(r,o):oe.cache.fetch(r)}),Object(a.k)(r.icon)){var o=n[r.icon]||r.icon;oe.cache.fetch(o,function(e){var t=e.blob;return new Promise(function(e,r){var n=t(),o=URL.createObjectURL(n),i=new Image,a=function(){return URL.revokeObjectURL(o)};i.onload=function(){a(),e()},i.onerror=function(){a(),r({type:"IMAGE_ERROR",url:o})},i.src=o})})}}(t,e),Object.assign(p.data.update,t,l),p.data.where={id:t.props.id},K(p),ee.emit("scriptChanged",p.data),p})}function we(e,t){var r=e.meta,n=t||e.custom.lastInstallURL,o=n?u()(r.require).concat(u()(Object.values(r.resources)),[r.icon]).reduce(function(e,t){if(t){var r=Object(a.e)(t,n);r!==t&&(e[t]=r)}return e},{}):{};return e.custom.pathMap=o,o}var ke={};function Se(e){var t={checking:!0},r={cmd:"UpdateScript",data:{where:{id:e.props.id},update:t}},n=e.custom.downloadURL||e.meta.downloadURL||e.custom.lastInstallURL,o=e.custom.updateURL||e.meta.updateURL||n;return o?(t.message=Object(a.i)("msgCheckingForUpdate"),K(r),Object(a.o)(o,{headers:{Accept:"text/x-userscript-meta"}}).then(function(n){var o=$(n.data);return function(e,t){for(var r=(e||"").split("."),n=(t||"").split("."),o=0;o<r.length||o<n.length;o+=1){var i=(parseInt(r[o],10)||0)-(parseInt(n[o],10)||0);if(i)return i<0?-1:1}return 0}(e.meta.version,o.version)<0?Promise.resolve():(t.checking=!1,t.message=Object(a.i)("msgNoUpdate"),K(r),Promise.reject())},function(){return t.checking=!1,t.message=Object(a.i)("msgErrorFetchingUpdateInfo"),K(r),Promise.reject()}).then(function(){return n?(t.message=Object(a.i)("msgUpdating"),K(r),Object(a.o)(n).then(function(e){return e.data},function(){return t.checking=!1,t.message=Object(a.i)("msgErrorFetchingScript"),K(r),Promise.reject()})):(t.message=Object(a.i)("msgNewVersion"),K(r),Promise.reject())})):Promise.reject()}function xe(e){var t=e.props.id,r=ke[t];if(!r){var n=!1;r=Se(e).then(function(e){return Oe({id:t,code:e,update:{checking:!1}})}).then(function(e){var t=e.data.update;n=!0,S("notifyUpdates")&&W({title:Object(a.i)("titleScriptUpdated"),body:Object(a.i)("msgScriptUpdated",[t.meta.name||Object(a.i)("labelNoName")])})}).catch(function(e){0}).then(function(){return delete ke[t],n}),ke[t]=r}return r}var Pe={},Me={},Ee=["user-agent","referer","origin","host","cookie"];function Te(e,t){var r=Pe[e.id];if(r&&!r.cb){r.cb=t;var n=r.xhr;try{n.open(e.method,e.url,!0,e.user||"",e.password||""),n.setRequestHeader("VM-Verify",e.id),e.headers&&Object.keys(e.headers).forEach(function(t){var r=t.toLowerCase();r.startsWith("vm-")||n.setRequestHeader(Ee.includes(r)?`VM-${t}`:t,e.headers[t])}),e.timeout&&(n.timeout=e.timeout),e.responseType&&(n.responseType="arraybuffer"),e.overrideMimeType&&n.overrideMimeType(e.overrideMimeType);var o=function(e){var t=Promise.resolve(),r=e.xhr;return function(n){var o={id:e.id,type:n.type,resType:r.responseType},i={finalUrl:r.responseURL,readyState:r.readyState,responseHeaders:r.getAllResponseHeaders(),status:r.status,statusText:r.statusText};o.data=i;try{i.responseText=r.responseText}catch(e){}"progress"===n.type&&["lengthComputable","loaded","total"].forEach(function(e){i[e]=n[e]}),"loadend"===n.type&&Ue(e),t=t.then(function(){if(r.response&&"arraybuffer"===r.responseType){var e=r.getResponseHeader("Content-Type")||"application/octet-stream",t=Object(a.a)(r.response);i.response=`data:${e};base64,${window.btoa(t)}`}else i.response=r.response}).then(function(){e.cb&&e.cb(o)})}}(r);["abort","error","load","loadend","progress","readystatechange","timeout"].forEach(function(e){n[`on${e}`]=o});var i=e.data,s=i?function e(t){var r=t.cls,n=t.value;if("formdata"===r){var o=new FormData;return n&&Object.keys(n).forEach(function(t){n[t].forEach(function(r){o.append(t,e(r))})}),o}if(["blob","file"].includes(r)){for(var i=t.type,a=t.name,s=t.lastModified,c=new Uint8Array(n.length),u=0;u<n.length;u+=1)c[u]=n.charCodeAt(u);var l=[c.buffer];return"file"===r?new File(l,a,{type:i,lastModified:s}):new Blob(l,{type:i})}if(n)return JSON.parse(n)}(i):null;n.send(s)}catch(e){console.warn(e)}}}function Ue(e){e.coreId&&delete Me[e.coreId],delete Pe[e.id]}function _e(e){return(e.code?Promise.resolve(e.code):Object(a.o)(e.url).then(function(e){var t,r=e.data;return/^\s*</.test(t=r)||t.indexOf(M)<0?Promise.reject(Object(a.i)("msgInvalidScript")):r})).then(function(t){f.put(e.url,t,3e3);var r=Object(a.h)();f.put(`confirm-${r}`,{url:e.url,from:e.from});var n=browser.runtime.getURL("/confirm/index.html");browser.tabs.create({url:`${n}#${r}`})})}browser.webRequest.onBeforeSendHeaders.addListener(function(e){var t=e.requestHeaders,r=[],n={};t.forEach(function(e){e.name.startsWith("VM-")?n[e.name.slice(3)]=e.value:r.push(e)});var o=n.Verify;if(o){var i=Pe[o];i&&(delete n.Verify,Me[e.requestId]=o,i.coreId=e.requestId,Object.keys(n).forEach(function(e){Ee.includes(e.toLowerCase())&&r.push({name:e,value:n[e]})}))}return{requestHeaders:r}},{urls:["<all_urls>"],types:["xmlhttprequest"]},["blocking","requestHeaders"]);var $e=/\.user\.js([?#]|$)/,Ie=["^https://greasyfork.org/scripts/[^/]*/code/[^/]*?\\.user\\.js([?#]|$)","^https://openuserjs.org/install/[^/]*/[^/]*?\\.user\\.js([?#]|$)","^https://github.com/[^/]*/[^/]*/raw/[^/]*/[^/]*?\\.user\\.js([?#]|$)","^https://gist.github.com/.*?/[^/]*?.user.js([?#]|$)"].map(function(e){return new RegExp(e)}),Re=["//(?:(?:gist.|)github.com|greasyfork.org|openuserjs.org)/"].map(function(e){return new RegExp(e)}),Ce={};function De(e){return Object.keys(e).map(function(t){return`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`}).join("&")}browser.webRequest.onBeforeRequest.addListener(function(e){var t=e.url;if("GET"===e.method&&$e.test(t)&&!Ce[t]&&(Ie.some(function(e){return e.test(t)})||!Re.some(function(e){return e.test(t)})))return Promise.all([Object(a.o)(t).catch(function(){return{data:""}}),e.tabId<0?Promise.resolve():browser.tabs.get(e.tabId)]).then(function(e){var r=i()(e,2),n=r[0].data,o=r[1];$(n).name?_e({code:n,url:t,from:o&&o.url}):(Ce[t]||(Ce[t]={timer:setTimeout(function(){delete Ce[t]},1e4)}),o&&o.id&&browser.tabs.update(o.id,{url:t}))}),{redirectUrl:"javascript:history.back()"}},{urls:["<all_urls>"],types:["main_frame"]},["blocking"]);var Ae,ze={update:e=>Oe(e),list:()=>ue(),get:e=>le(e),remove:e=>ve(e)},qe=[],Le=[],Ne={},Ve=Object(a.c)(nt,36e5),Be=Promise.resolve();function Fe(e){var t=e.name,r=e.uri;return r?function(e){return`vm-${encodeURIComponent(e)}`}(r):t}function He(e){return/^vm-/.test(e)}function Ge(e){return decodeURIComponent(e.slice(3))}function Je(e,t,r){var n=t||e[0];function o(){return n}return{get:o,set:function(t){return e.includes(t)?(n=t,r&&r()):console.warn("Invalid state:",t),o()},is:function(e){return(Array.isArray(e)?e:[e]).includes(n)}}}function We(){return qe.map(function(e){var t=Ne[e];return{name:t.name,displayName:t.displayName,authState:t.authState.get(),syncState:t.syncState.get(),lastSync:t.config.get("meta",{}).lastSync,progress:t.progress}})}function Ke(e){var t=function(){this.initialize()};return t.prototype=e,t.extend=Ze,t}function Ze(e){return Ke(Object.assign(Object.create(this.prototype),e))}var Xe=Object(a.c)(function(){K({cmd:"UpdateSync",data:We()})}),Qe=Ke({name:"base",displayName:"BaseService",delayTime:1e3,urlPrefix:"",metaFile:"Violentmonkey",initialize(){var e=this;this.progress={finished:0,total:0},this.config=function(e){function t(t){var r=Object(a.n)(t);return r.unshift("services",e),r}return{get:function(e,r){return Ae.get(t(e),r)},set:function(e,r){if("object"==typeof e){var n=e;Object.keys(n).forEach(function(e){Ae.set(t(e),n[e])})}else Ae.set(t(e),r)},clear:function(){Ae.set(t(),{})}}}(this.name),this.authState=Je(["idle","initializing","authorizing","authorized","unauthorized","error"],null,Xe),this.syncState=Je(["idle","ready","syncing","error"],null,Xe),this.lastFetch=Promise.resolve(),this.startSync=this.syncFactory();var t=function(){var e={};return{on:function(t,r){var n=e[t];n||(n=[],e[t]=n),n.push(r)},off:function(t,r){var n=e[t];if(n){var o=n.indexOf(r);o>=0&&n.splice(o,1)}},fire:function(t,r){var n=e[t];n&&n.forEach(function(e){e(r,t)})}}}();["on","off","fire"].forEach(function(r){e[r]=function(){t[r].apply(t,arguments)}})},log(){var e;(e=console).log.apply(e,arguments)},syncFactory(){var e,t,r=this,n=function(){return r.authState.is("authorized")&&et()===r.name},o=function(){if(!n())return Promise.resolve();r.log("Ready to sync:",r.displayName),r.syncState.set("ready"),Be=Be.then(function(){return new Promise(function(e){(t=Object(a.c)(e,1e4))()})}).then(function(){if(n())return r.sync();r.syncState.set("idle")}).catch(function(e){console.error(e)}).then(function(){e=null,t=null}),e=Be};return function(){return e||o(),t&&t(),e}},prepareHeaders(){this.headers={}},prepare(){var e=this;return this.authState.set("initializing"),(this.initToken()?Promise.resolve(this.user()):Promise.reject({type:"unauthorized"})).then(function(){e.authState.set("authorized")},function(t){throw t&&"unauthorized"===t.type?e.authState.set("unauthorized"):(console.error(t),e.authState.set("error")),e.syncState.set("idle"),t})},checkSync(){var e=this;return this.prepare().then(function(){return e.startSync()})},user:a.m,handleMetaError(e){throw e},getMeta(){var e=this;return this.get({name:this.metaFile}).then(function(e){return JSON.parse(e)}).catch(function(t){return e.handleMetaError(t)})},initToken(){this.prepareHeaders();var e=this.config.get("token");return this.headers.Authorization=e?`Bearer ${e}`:null,!!e},loadData(e){var t=this,r=this.progress,n=e.delay;null==n&&(n=this.delayTime);var o=Promise.resolve();return n&&(o=this.lastFetch.then(function(e){return new Promise(function(t){var r=n-(Date.now()-e);r>0?setTimeout(t,r):t()})}).then(function(){return Date.now()}),this.lastFetch=o),r.total+=1,Xe(),o.then(function(){var r=e.prefix;null==r&&(r=t.urlPrefix);var n=Object.assign({},t.headers,e.headers),o=e.url;return o.startsWith("/")&&(o=r+o),Object(a.o)(o,{headers:n,method:e.method,body:e.body,responseType:e.responseType})}).then(function(e){return{data:e.data}},function(e){return{error:e}}).then(function(e){var t=e.data,n=e.error;return r.finished+=1,Xe(),n?Promise.reject(n):t})},getLocalData:()=>ze.list(),getSyncData(){var e=this;return this.getMeta().then(function(t){return Promise.all([{name:e.metaFile,data:t},e.list(),e.getLocalData()])})},sync(){var e=this;return this.progress={finished:0,total:0},this.syncState.set("syncing"),this.prepare().then(function(){return e.getSyncData()}).then(function(t){var r=i()(t,3),n=r[0],o=r[1],c=r[2],l=n.data,f=l.info||{},p=l.timestamp||0,d=!p||Object.keys(f).length!==o.length,h=Date.now(),m=S("lastModified"),v={},g=e.config.get("meta",{}),b=!g.timestamp,y=b||p>g.timestamp;e.log("First sync:",b),e.log("Outdated:",y,"(","local:",g.timestamp,"remote:",p,")");var j=[],O=[],w=[],k=[],x=[];l.info=o.reduce(function(e,t){v[t.uri]=t;var r=f[t.uri];return r||(r={},d=!0),e[t.uri]=r,r.modified||(r.modified=h,d=!0),e},{}),c.forEach(function(e){var t=e.props,r=t.uri,n=t.position,o=t.lastModified,i=l.info[r];if(i){var a=v[r];b||!o||i.modified>o?j.push({local:e,remote:a,info:i}):(i.modified<o&&(O.push({local:e,remote:a}),i.modified=o,d=!0),i.position!==n&&(i.position&&m<=p?x.push({local:e,remote:a,info:i}):(i.position=n,d=!0))),delete v[r]}else b||!y||o>p?O.push({local:e}):k.push({local:e})}),Object.keys(v).forEach(function(e){var t=v[e],r=l.info[e];y?j.push({remote:t,info:r}):w.push({remote:t})});var P=u()(j.map(function(t){var r=t.remote,n=t.info;return e.log("Download script:",r.uri),e.get(r).then(function(e){var t=function(e){var t={};try{var r=JSON.parse(e);t.code=r.code,2===r.version?(t.config=r.config,t.custom=r.custom,t.props=r.props):1===r.version&&r.more&&(t.custom=r.more.custom,t.config=Object(s.c)({enabled:r.more.enabled,shouldUpdate:r.more.update}),t.props=Object(s.c)({lastUpdated:r.more.lastUpdated}))}catch(r){t.code=e}return t}(e);if(t.code){n.modified&&Object(s.d)(t,"props.lastModified",n.modified);var r=+n.position;return r&&(t.position=r),!S("syncScriptStatus")&&t.config&&delete t.config.enabled,ze.update(t)}})})).concat(u()(O.map(function(t){var r=t.local,n=t.remote;return e.log("Upload script:",r.props.uri),ze.get(r.props.id).then(function(t){var o=function(e,t,r){var n;return 2===t?n={version:t,custom:e.custom,config:e.config,props:Object(s.b)(e.props,["lastUpdated"])}:1===t&&(n={version:t,more:{custom:e.custom,enabled:e.config.enabled,update:e.config.shouldUpdate,lastUpdated:e.props.lastUpdated}}),Object.assign(n,r)}(r,1,{code:t});return l.info[r.props.uri]={modified:r.props.lastModified,position:r.props.position},d=!0,e.put(Object.assign({},n,{uri:r.props.uri}),JSON.stringify(o))})})),u()(w.map(function(t){var r=t.remote;return e.log("Remove remote script:",r.uri),delete l.info[r.uri],d=!0,e.remove(r)})),u()(k.map(function(t){var r=t.local;return e.log("Remove local script:",r.props.uri),ze.remove(r.props.id)})),u()(x.map(function(e){var t=e.local,r=e.info,n={};return r.position&&(n.props={position:r.position}),be(t.props.id,n)})));return P.push(Promise.all(P).then(function(){return se()}).then(function(e){if(e)return d=!0,ze.list().then(function(e){e.forEach(function(e){var t=l.info[e.props.uri];t&&(t.position=e.props.position)})})})),P.push(Promise.all(P).then(function(){var t=[];return d&&(l.timestamp=Date.now(),t.push(e.put(n,JSON.stringify(l)))),g.timestamp=l.timestamp,g.lastSync=Date.now(),e.config.set("meta",g),Promise.all(t)})),Promise.all(P.map(function(e){return e.then(a.m,function(e){return e||!0})})).then(function(e){return e.filter(Boolean)}).then(function(e){if(e.length)throw e})}).then(function(){e.syncState.set("idle")},function(t){e.syncState.set("error"),e.log("Failed syncing:",e.name),e.log(t)})}});function Ye(e){Le.push(e)}function et(){return Ae.get("current")}function tt(e){return Ne[e||et()]}function rt(){Ae||(Ae=function(){function e(e,t){var r=Object(a.n)(e);r.unshift("sync"),x(r,t)}var t;return(t=S("sync"))&&t.services||e([],t={services:{}}),{get:function(e,t){var r=Object(a.n)(e);return r.unshift("sync"),S(r,t)},set:e}}(),Le.forEach(function(e){var t=new e,r=t.name;qe.push(r),Ne[r]=t}));var e=tt();e&&e.checkSync()}function nt(){var e=tt();return e&&Promise.resolve(function(e){if(!e.syncState.is(["ready","syncing"]))return e.authState.is(["idle","error"])?e.checkSync():e.authState.is("authorized")?e.startSync():void 0}(e)).then(Ve)}P(function(e){Object(s.a)(e,"sync.current")&&rt()});var ot="f0q12zup2uys5w8",it="https://violentmonkey.github.io/auth_dropbox.html";function at(e){return{size:e.size,uri:Ge(e.name)}}Ye(Qe.extend({name:"dropbox",displayName:"Dropbox",user(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/users/get_current_account"}).catch(function(e){return 401===e.status?Promise.reject({type:"unauthorized"}):Promise.reject({type:"error",data:e})})},handleMetaError(e){if(409===e.status)return{};throw e},list(){return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/list_folder",body:{path:""},responseType:"json"}).then(function(e){return e.entries.filter(function(e){return"file"===e[".tag"]&&He(e.name)}).map(at)})},get(e){var t=Fe(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/download",headers:{"Dropbox-API-Arg":JSON.stringify({path:`/${t}`})}})},put(e,t){var r=Fe(e);return this.loadData({method:"POST",url:"https://content.dropboxapi.com/2/files/upload",headers:{"Dropbox-API-Arg":JSON.stringify({path:`/${r}`,mode:"overwrite"}),"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(at)},remove(e){var t=Fe(e);return this.loadData({method:"POST",url:"https://api.dropboxapi.com/2/files/delete",body:{path:`/${t}`},responseType:"json"}).then(at)},authorize(){var e=`https://www.dropbox.com/oauth2/authorize?${De({response_type:"token",client_id:ot,redirect_uri:it})}`;browser.tabs.create({url:e})},authorized(e){var t=e.split("&").reduce(function(e,t){var r=t.split("=");return e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]),e},{});t.access_token&&this.config.set({uid:t.uid,token:t.access_token})},checkAuth(e){var t=`${it}#`;if(e.startsWith(t))return this.authorized(e.slice(t.length)),this.checkSync(),!0},revoke(){return this.config.set({uid:null,token:null}),this.prepare()}}));var st=JSON.parse(window.atob("eyJjbGllbnRfc2VjcmV0Ijoiajl4M09WRXRIdmhpSEtEV09HcXV5TWZaS2s5NjA0MEgifQ==")),ct=Object.assign({client_id:"000000004418358A",redirect_uri:"https://violentmonkey.github.io/auth_onedrive.html"},st);function ut(e){return{size:e.size,uri:Ge(e.name)}}Ye(Qe.extend({name:"onedrive",displayName:"OneDrive",urlPrefix:"https://api.onedrive.com/v1.0",refreshToken(){var e=this,t=this.config.get("refresh_token");return this.authorized({refresh_token:t,grant_type:"refresh_token"}).then(function(){return e.prepare()})},user(){var e=this,t=function(){return e.loadData({url:"/drive",responseType:"json"})};return t().catch(function(r){if(401===r.status)return e.refreshToken().then(t);throw r}).catch(function(e){return 400===e.status&&"invalid_grant"===Object(s.a)(e,"data.error")?Promise.reject({type:"unauthorized"}):Promise.reject({type:"error",data:e})})},handleMetaError(e){var t=this;if(404===e.status){var r=e.xhr.getResponseHeader("WWW-Authenticate")||"";return/^Bearer realm="OneDriveAPI"/.test(r)?this.refreshToken().then(function(){return t.getMeta()}):{}}throw e},list(){return this.loadData({url:"/drive/special/approot/children",responseType:"json"}).then(function(e){return e.value.filter(function(e){return e.file&&He(e.name)}).map(ut)})},get(e){var t=this,r=Fe(e);return this.loadData({url:`/drive/special/approot:/${encodeURIComponent(r)}`,responseType:"json"}).then(function(e){return t.loadData({url:e["@content.downloadUrl"],delay:!1})})},put(e,t){var r=Fe(e);return this.loadData({method:"PUT",url:`/drive/special/approot:/${encodeURIComponent(r)}:/content`,headers:{"Content-Type":"application/octet-stream"},body:t,responseType:"json"}).then(ut)},remove(e){var t=Fe(e);return this.loadData({method:"DELETE",url:`/drive/special/approot:/${encodeURIComponent(t)}`}).catch(a.m)},authorize(){var e=`https://login.live.com/oauth20_authorize.srf?${De({client_id:ct.client_id,scope:"onedrive.appfolder wl.offline_access",response_type:"code",redirect_uri:ct.redirect_uri})}`;browser.tabs.create({url:e})},checkAuth(e){var t=this,r=`${ct.redirect_uri}?code=`;if(e.startsWith(r))return this.authState.set("authorizing"),this.authorized({code:e.slice(r.length)}).then(function(){return t.checkSync()}),!0},revoke(){return this.config.set({uid:null,token:null,refresh_token:null}),this.prepare()},authorized(e){var t=this;return this.loadData({method:"POST",url:"https://login.live.com/oauth20_token.srf",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:De(Object.assign({},{client_id:ct.client_id,client_secret:ct.client_secret,redirect_uri:ct.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then(function(e){if(!e.access_token)throw e;t.config.set({uid:e.user_id,token:e.access_token,refresh_token:e.refresh_token})})}}));var lt=JSON.parse(window.atob("eyJjbGllbnRfc2VjcmV0IjoiTjBEbTZJOEV3bkJaeE1xMUpuMHN3UER0In0=")),ft=Object.assign({client_id:"590447512361-05hjbhnf8ua3iha55e5pgqg15om0cpef.apps.googleusercontent.com",redirect_uri:"https://violentmonkey.github.io/auth_googledrive.html",scope:"https://www.googleapis.com/auth/drive.appdata"},lt),pt={status:"UNAUTHORIZED"};function dt(e){return{id:e.id,size:+e.size,uri:Ge(e.name)}}Ye(Qe.extend({name:"googledrive",displayName:"Google Drive",urlPrefix:"https://www.googleapis.com/drive/v3",refreshToken(){var e=this,t=this.config.get("refresh_token");return t?this.authorized({refresh_token:t,grant_type:"refresh_token"}).then(function(){return e.prepare()}):Promise.reject({type:"unauthorized"})},user(){var e=this,t=function(){return e.loadData({url:`https://www.googleapis.com/oauth2/v3/tokeninfo?${De({access_token:e.config.get("token")})}`,responseType:"json"})};return t().then(function(t){return"online"===t.access_type?e.loadData({method:"POST",url:`https://accounts.google.com/o/oauth2/revoke?token=${e.config.get("token")}`,prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){return W({title:"Sync Upgraded",body:"Please reauthorize access to your Google Drive to complete the upgradation."}),Promise.reject("Online access revoked.")}):t.scope!==ft.scope?Promise.reject(pt):void 0}).catch(function(r){return r===pt||400===r.status&&"Invalid Value"===Object(s.a)(r,"data.error_description")?e.refreshToken().then(t):Promise.reject({type:"error",data:r})})},getSyncData(){var e=this;return this.loadData({url:`/files?${De({spaces:"appDataFolder",fields:"files(id,name,size)"})}`,responseType:"json"}).then(function(t){var r,n=t.files.filter(function(t){return!!He(t.name)||(r||t.name!==e.metaFile?e.remove(t):r=t,!1)}).map(dt).filter(function(t){return!!t.size||(e.remove(t),!1)}),o=r?dt(r):{},i=e.get(o).then(function(e){return JSON.parse(e)}).catch(function(t){return e.handleMetaError(t)}).then(function(t){return Object.assign({},o,{data:t,uri:null,name:e.metaFile})});return Promise.all([i,n,e.getLocalData()])})},authorize(){var e={response_type:"code",access_type:"offline",client_id:ft.client_id,redirect_uri:ft.redirect_uri,scope:ft.scope};this.config.get("refresh_token")||(e.prompt="consent");var t=`https://accounts.google.com/o/oauth2/v2/auth?${De(e)}`;browser.tabs.create({url:t})},checkAuth(e){var t=this,r=`${ft.redirect_uri}?code=`;if(e.startsWith(r))return this.authState.set("authorizing"),this.authorized({code:e.split("#")[0].slice(r.length)}).then(function(){return t.checkSync()}),!0},revoke(){return this.config.set({token:null,refresh_token:null}),this.prepare()},authorized(e){var t=this;return this.loadData({method:"POST",url:"https://www.googleapis.com/oauth2/v4/token",prefix:"",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:De(Object.assign({},{client_id:ft.client_id,client_secret:ft.client_secret,redirect_uri:ft.redirect_uri,grant_type:"authorization_code"},e)),responseType:"json"}).then(function(e){if(!e.access_token)throw e;var r={token:e.access_token};e.refresh_token&&(r.refresh_token=e.refresh_token),t.config.set(r)})},handleMetaError:()=>({}),list(){throw new Error("Not supported")},get(e){var t=e.id;return t?this.loadData({url:`/files/${t}?alt=media`}):Promise.reject()},put(e,t){var r=Fe(e),n=e.id,o=Object(a.h)("violentmonkey-is-great-"),i={"Content-Type":`multipart/related; boundary=${o}`},s=n?{name:r}:{name:r,parents:["appDataFolder"]},c=[`--${o}`,"Content-Type: application/json; charset=UTF-8","",JSON.stringify(s),`--${o}`,"Content-Type: text/plain","",t,`--${o}--`,""].join("\r\n"),u=n?`https://www.googleapis.com/upload/drive/v3/files/${n}?uploadType=multipart`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart";return this.loadData({url:u,body:c,headers:i,method:n?"PATCH":"POST"})},remove(e){var t=e.id;return this.loadData({method:"DELETE",url:`/files/${t}`})}})),browser.tabs.onUpdated.addListener(function(e,t){var r;t.url&&(r=t.url,qe.some(function(e){var t=Ne[e];return t.checkAuth&&t.checkAuth(r)}))&&browser.tabs.remove(e)});var ht=r(18),mt={};browser.tabs.onRemoved.addListener(function(e){var t=mt[e];t&&(browser.tabs.sendMessage(t,{cmd:"TabClosed",data:e}).catch(a.m),delete mt[e])});var vt={};browser.notifications.onClicked.addListener(function(e){var t=vt[e];t&&browser.tabs.sendMessage(t,{cmd:"NotificationClick",data:e}).catch(a.m)}),browser.notifications.onClosed.addListener(function(e){var t=vt[e];t&&(browser.tabs.sendMessage(t,{cmd:"NotificationClose",data:e}).catch(a.m),delete vt[e])});var gt,bt,yt={},jt={};function Ot(e,t){return function(e,t){return(e.id?Promise.resolve(e.id):ce(e).then(function(e){return Object(s.a)(e,"props.id")})).then(function(e){if(e)return pe({[e]:t})})}(e,t).then(xt)}function wt(e){var t=jt[e];t&&(Object.keys(t).forEach(function(t){var r=yt[t];r&&delete r[e]}),delete jt[e])}function kt(){bt||(bt=Promise.resolve().then(St))}function St(){var e=gt;gt=null;var t=Object.keys(e);fe(t).then(function(r){return t.forEach(function(t){var n=r[t]||{};r[t]=n;var o=e[t]||{};Object.keys(o).forEach(function(e){var t=o[e];t?n[e]=t:delete n[e]})}),pe(r)}).then(xt).catch(function(e){console.error("Values error:",e)}).then(function(){bt=null,gt&&kt()})}function xt(e){if(e){var t=Object.keys(e).reduce(function(e,t){return Object.assign(e,yt[t])},{});Object.keys(t).forEach(function(t){browser.tabs.sendMessage(+t,{cmd:"UpdatedValues",data:e}).catch(a.m)})}}browser.tabs.onRemoved.addListener(function(e){wt(e)});var Pt,Mt=browser.runtime.getManifest().version,Et=["setIcon","setBadgeText","setBadgeBackgroundColor"].reduce(function(e,t){var r=browser.browserAction[t];return e[t]=r?r.bind(browser.browserAction):a.m,e},{});function Tt(){x("lastUpdate",Date.now()),ue().then(function(e){var t=e.filter(function(e){return Object(s.a)(e,"config.shouldUpdate")});return Promise.all(t.map(xe))}).then(function(e){e.some(Boolean)&&nt()})}function Ut(){Pt||(Pt=!0,function e(){new Promise(function(e,t){if(!S("autoUpdate"))return t();Date.now()-S("lastUpdate")>=864e5&&e(Tt())}).then(function(){return setTimeout(e,36e5)},function(){Pt=!1})}())}P(function(e){"isApplied"in e&&Rt(e.isApplied),"autoUpdate"in e&&Ut(),"showBadge"in e&&browser.tabs.query({}).then(function(e){e.forEach(function(e){It(e.id)})});var t;"scriptTemplate"in e&&!e.scriptTemplate&&x("scriptTemplate",(t="scriptTemplate",Object(s.a)(g,t))),K({cmd:"UpdateOptions",data:e})});var _t={NewScript:e=>e&&f.get(`new-${e}`)||I(),CacheNewScript(e){var t=Object(a.h)();return f.put(`new-${t}`,I(e)),t},RemoveScript:e=>ve(e).then(function(){nt()}),GetData:e=>(e?me():Promise.resolve()).then(he).then(function(e){return e.sync=We(),e.version=Mt,e}),GetInjected(e,t){var r=e.url,n=e.reset,o=t.tab||{};n&&o.id&&wt(o.id);var i={isApplied:S("isApplied"),injectInto:S("defaultInjectInto"),version:Mt};return i.isApplied?de(r).then(function(e){var t,r,n;return t=o.id,r=Object.keys(e.values),(n=jt[t])||(n={},jt[t]=n),r.forEach(function(e){n[e]=1;var r=yt[e];r||(r={},yt[e]=r),r[t]=1}),Object.assign(i,e)}):i},UpdateScriptInfo:e=>be(e.id,{config:e.config,props:{lastModified:Date.now()}}).then(function(e){var t=i()(e,1)[0];nt(),K({cmd:"UpdateScript",data:{where:{id:t.props.id},update:t}})}),GetValueStore:e=>fe([e]).then(function(t){return t[e]||{}}),SetValueStore:e=>Ot(e.where,e.valueStore),UpdateValue:e=>(function(e,t){kt();var r=t.key,n=t.value;gt||(gt={});var o=gt[e];o||(o={},gt[e]=o),o[r]=n||null})(e.id,e.update),ExportZip:e=>(function(e,t){var r=e.filter(function(e){var t=ne.scriptMap[e];return t&&!t.config.removed});return Promise.all([Promise.all(r.map(function(e){return ce({id:e})})),oe.code.getMulti(r)]).then(function(r){var n=i()(r,2),o=n[0],a=n[1],s={};return s.items=o.map(function(e){return{script:e,code:a[e.props.id]}}),t?oe.value.getMulti(e).then(function(e){return s.values=e,s}):s})})(e.ids,e.values),GetScriptCode:e=>le(e),GetMetas:e=>(function(e){return Promise.all(e.map(function(e){return ce({id:e})})).then(function(e){return e.filter(Boolean)})})(e),Move:e=>(function(e,t){var r=ne.scripts.findIndex(function(t){return e===Object(s.a)(t,"props.id")}),n=t>0?1:-1,o=r,i=r+t,a=Math.min(o,i),c=Math.max(o,i),l=ne.scripts.slice(a,c+1);return n>0?l.push(l.shift()):l.unshift(l.pop()),ne.scripts=u()(ne.scripts.slice(0,a)).concat(u()(l),u()(ne.scripts.slice(c+1))),ae()})(e.id,e.offset).then(function(){nt()}),Vacuum:function(){var e={},t={},r={},n={},o=[[oe.value,e],[oe.cache,t],[oe.require,r],[oe.code,n]];return browser.storage.local.get().then(function(s){Object.keys(s).forEach(function(e){o.some(function(t){var r=i()(t,2),n=r[0],o=r[1],a=n.prefix;return!!e.startsWith(a)&&(o[e.slice(a.length)]=-1,!0)})});var c=function(e,t){e[t]<0?e[t]=1:e[t]||(e[t]=2)};ne.scripts.forEach(function(o){var i=o.props.id;c(n,i),c(e,i),o.custom.pathMap||we(o);var s=o.custom.pathMap;o.meta.require.forEach(function(e){c(r,s[e]||e)}),Object.values(o.meta.resources).forEach(function(e){c(t,s[e]||e)});var u=o.meta.icon;if(Object(a.k)(u)){var l=s[u]||u;c(t,l)}}),o.forEach(function(e){var t=i()(e,2),r=t[0],n=t[1];Object.keys(n).forEach(function(e){var t=n[e];t<0?r.remove(e):2===t&&r.fetch&&r.fetch(e)})})})},ParseScript:e=>Oe(e).then(function(e){return nt(),e.data}),CheckUpdate(e){ce({id:e}).then(xe).then(function(e){e&&nt()})},CheckUpdateAll:Tt,ParseMeta:e=>$(e),GetRequestId:function(){var e=Object(a.h)();return Pe[e]={id:e,xhr:new XMLHttpRequest},e},HttpRequest(e,t){Te(e,function(e){browser.tabs.sendMessage(t.tab.id,{cmd:"HttpRequested",data:e}).catch(a.m)})},AbortRequest:function(e){var t=Pe[e];t&&(t.xhr.abort(),Ue(t))},SetBadge:function(e,t){var r=e.ids,n=e.reset,o=t.tab||{},i=!n&&$t[o.id];i||(i={number:0,unique:0,idMap:{}},$t[o.id]=i);i.number+=r.length,r&&(r.forEach(function(e){i.idMap[e]=1}),i.unique=Object.keys(i.idMap).length);Et.setBadgeBackgroundColor({color:"#808",tabId:o.id}),It(o.id)},SyncAuthorize:function(){var e=tt();e&&e.authorize()},SyncRevoke:function(){var e=tt();e&&e.revoke()},SyncStart:nt,CacheLoad:e=>f.get(e)||null,CacheHit(e){f.hit(e.key,e.lifetime)},Notification:function(e,t){var r=t.tab||{};return browser.notifications.create({type:"basic",title:e.title||Object(a.i)("extName"),message:e.text,iconUrl:e.image||a.d}).then(function(e){return vt[e]=r.id,e})},SetClipboard:function(e){n=e,p.focus(),document.execCommand("copy",!1,null)},TabOpen:function(e,t){var r=e.url,n=e.active,o=t.tab||{},i={url:r,active:n,windowId:o.windowId,index:o.index+1};return ht.b&&ht.a||(i.openerTabId=o.id),browser.tabs.create(i).then(function(e){var t=e.id;return mt[t]=o.id,{id:t}})},TabClose:function(e,t){var r=e&&e.id||t.tab&&t.tab.id;r&&browser.tabs.remove(r)},GetAllOptions:function(){return Object.keys(g).reduce(function(e,t){return e[t]=S(t),e},{})},GetOptions:e=>e.reduce(function(e,t){return e[t]=S(t),e},{}),SetOptions(e){(Array.isArray(e)?e:[e]).forEach(function(e){x(e.key,e.value)})},ConfirmInstall:_e,CheckScript:e=>ce({meta:{name:e.name,namespace:e.namespace}}).then(function(e){return e?e.meta.version:null}),CheckPosition:()=>se(),InjectScript:(e,t)=>browser.tabs.executeScript(t.tab.id,{code:`${e};0`,runAt:"document_start"})};Promise.all(m.map(function(e){return"function"==typeof e?e():e})).then(function(){}).then(function(){browser.runtime.onMessage.addListener(function(e,t){var r,n=_t[e.cmd];return n&&void 0!==(r=n(e.data,t))&&(r=Promise.resolve(r).then(function(e){return{data:e}},function(e){return{error:e}})),r||null}),setTimeout(Ut,2e4),rt(),G(),me()});var $t={};function It(e){var t=$t[e];if(t){var r,n=S("showBadge");"total"===n?r=t.number:n&&(r=t.unique),Et.setBadgeText({text:`${r||""}`,tabId:e})}}function Rt(e){Et.setIcon({path:{19:`/public/images/icon19${e?"":"w"}.png`,38:`/public/images/icon38${e?"":"w"}.png`}})}browser.tabs.onRemoved.addListener(function(e){delete $t[e]}),Rt(S("isApplied"))},21:function(e,t,r){var n=r(66);e.exports=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){n(e,t,r[t])})}return e}},66:function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},80:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},81:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}});