"use strict";var Search=new Vue({el:"#search",created:function(){var t=this;t.initData(),infinity.onMessage("onRecoverySetView",function(){t.initData()}),infinity.onMessage("defaultSearchChange",function(){t.initData()}),infinity.onMessage("searchAddChange",function(){t.initData()}),t.hideSuggesstion(),$(document).on("keydown","#search-input",function(e){13==e.which&&t.go()})},data:{isOpenSelect:!1,typeSelect:0,searches:[],input:"",suggestions:[],searchSuggesutAjaxZh:!1,searchSuggesutAjaxOther:!1,suIndex:-1,preInput:"",showSu:!0,isShowSearchBtn:SETTING.isShowSearchBtn,logoSuffix:"Chrome"==infinity.browser?"?imageView2/0/format/webp/q/48/v/1":"?imageView2/0/format/png/q/48/v/1"},methods:{initData:function(){this.searches=infinity.get("infinity-searches")},reloadSetting:function(){this.isShowSearchBtn=SETTING.isShowSearchBtn},openSearchSelect:function(){this.isOpenSelect=!0},hideSearchSelect:function(){this.isOpenSelect=!1,$("#search-input")[0].focus()},changeSearch:function(e){var t=this;t.searches.current=e,t.isOpenSelect=!1,t.typeSelect=0,infinity.set("infinity-searches",t.searches),$("#search-input")[0].focus(),infinity.sendMessage("defaultSearchChange")},changeType:function(e){this.typeSelect=e,$("#search-input")[0].focus()},hideSuggesstion:function(){var t=this;$(document).on("click",function(e){t.suggestions=[]})},onSearchBtn:function(e){$("#search-input")[0].focus();this.go()},go:function(e,t){t&&t.stopPropagation();var s=this,n=void 0,i=SETTING.isSearchInNewTab?"_blank":"_self";e=e||s.suggestions[s.suIndex],infinity.sendMessage("ga-search",s.searches.current),e?"suggs"==e.type?e.isUrl?n=e.text:(n=s.searches.current.types[s.typeSelect].url.replace("%s",encodeURIComponent(e.text)),"c26068f55492ef9e93e05e34a3b31139"==s.searches.current.seId&&0==s.typeSelect&&(s.useISFeedSearch(e.text,i),n=!1)):n=e.url.replace("%s",encodeURIComponent(s.input)):(n=s.searches.current.types[s.typeSelect].url.replace("%s",encodeURIComponent(s.input)),"c26068f55492ef9e93e05e34a3b31139"==s.searches.current.seId&&0==s.typeSelect&&(s.useISFeedSearch(s.input,i),n=!1)),n&&(s.suggestions=[],window.open(n,i))},useISFeedSearch:function(e,t){Feed.getInstance("gsp_infinitynewtab_00_00").search(encodeURIComponent(e),t)},showAddSide:function(){infinity.import("search-add",".side-all",function(){$(".i-search-add").removeClass("i-side-hide"),$(".i-search-add")[0].offsetHeight,$(".i-search-add").addClass("i-side-show")});try{iView.showCover()}catch(e){}},inputSuggest:function(e){this.startSuggest()},keyupSuggest:function(e){32==e.which&&this.startSuggest()},startSuggest:function(e){var t=this;if(t.showSu=!0,t.preInput=t.input,t.suIndex=-1,""==t.input)return t.suggestions=[],t.searchSuggesutAjaxZh&&t.searchSuggesutAjaxZh.abort(),void(t.searchSuggesutAjaxOther&&t.searchSuggesutAjaxOther.abort());infinity.isZh()?t.getZhSuggestion():t.getOtherSuggestion()},getZhSuggestion:function(){var u=this;u.searchSuggesutAjaxZh&&u.searchSuggesutAjaxZh.abort(),u.searchSuggesutAjaxZh=$.get({url:"http://suggestion.baidu.com/su?wd="+u.input+"&p=3&t="+(new Date).getTime()+"&cb=",dataType:"text",success:function(e){try{var t=e.substr(0,e.length-3).split(",s:")[1],n=JSON.parse(t),i=[];n.map(function(e,t){var s={type:"suggs",isUrl:!1,text:n[t]};i.push(s)});var s=u.searches.additions.concat(i.splice(0,7));u.suggestions=s}catch(e){}}})},getOtherSuggestion:function(){var e=this;e.searchSuggesutAjaxOther&&e.searchSuggesutAjaxOther.abort(),e.searchSuggesutAjaxOther=$.get({url:"http://google.com/complete/search?client=chrome&q="+e.input+"&hl="+chrome.i18n.getUILanguage()+"&infinityTime="+(new Date).getTime(),dataType:"json",success:function(n){try{var i=[];n[2].map(function(e,t){var s={type:"suggs",isUrl:!1,text:n[1][t]};""!=e&&(s.isUrl=!0),i.push(s)}),e.suggestions=e.searches.additions.concat(i.splice(0,7))}catch(e){}}})},down:function(e){e.preventDefault();var t=this;t.suIndex+=1,t.suIndex==t.suggestions.length?(t.suIndex=-1,t.input=t.preInput):t.suggestions[t.suIndex].text?t.input=t.suggestions[t.suIndex].text:t.input=t.preInput},up:function(e){e.preventDefault();var t=this;t.suIndex-=1,-2==t.suIndex&&(t.suIndex=t.suggestions.length-1),-1==t.suIndex?t.input=t.preInput:t.suggestions[t.suIndex].text?t.input=t.suggestions[t.suIndex].text:t.input=t.preInput}}});